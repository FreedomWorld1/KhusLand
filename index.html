<!DOCTYPE html>
<html>
<head>
    <title>ğŸª CC-Shop FINANZSISTEM</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial; background: #0f172a; color: white; padding: 20px; }
        
        .container { max-width: 800px; margin: 0 auto; }
        
        .header { 
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .balance { 
            background: #1e293b;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .balance h2 { color: #60a5fa; margin-bottom: 15px; }
        .amount { font-size: 3.5rem; font-weight: bold; color: #fbbf24; margin: 20px 0; }
        
        .buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        button {
            padding: 20px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: 0.3s;
        }
        
        button:hover { transform: translateY(-3px); }
        
        .hold { background: #8b5cf6; }
        .deposit { background: #10b981; }
        .withdraw { background: #ef4444; }
        .save { background: #3b82f6; }
        .load { background: #f59e0b; }
        
        .transactions {
            background: #1e293b;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .transaction {
            background: #0f172a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #f59e0b;
        }
        
        .log {
            background: #1e293b;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸª CC-SHOP FINANZSISTEM</h1>
            <p>ğŸ“… Lokale Datenbank - Kein Firebase nÃ¶tig!</p>
        </div>
        
        <!-- Balance -->
        <div class="balance">
            <h2>ğŸ’° VERFÃœGBARES GUTHABEN</h2>
            <div class="amount" id="balance">5.000 $</div>
            <p>ğŸ’µ Sofort verfÃ¼gbar fÃ¼r Auszahlungen</p>
        </div>
        
        <!-- Buttons -->
        <div class="buttons">
            <button class="hold" onclick="addHold(100)">â¸ï¸ 100$ zurÃ¼ckhalten</button>
            <button class="deposit" onclick="addDeposit(500)">â• 500$ einzahlen</button>
            <button class="withdraw" onclick="addWithdraw(200)">â– 200$ auszahlen</button>
        </div>
        
        <!-- Save/Load -->
        <div style="display: flex; gap: 15px; margin: 20px 0;">
            <button class="save" onclick="saveData()">ğŸ’¾ Daten speichern</button>
            <button class="load" onclick="loadData()">ğŸ“‚ Daten laden</button>
            <button class="load" onclick="exportData()">ğŸ“¤ Exportieren</button>
            <button class="save" onclick="importData()">ğŸ“¥ Importieren</button>
        </div>
        
        <!-- Transactions -->
        <div class="transactions">
            <h3>ğŸ“‹ TRANSACTIONEN:</h3>
            <div id="transactionsList">
                <!-- Hier kommen die Transaktionen -->
            </div>
        </div>
        
        <!-- Log -->
        <div class="log">
            <h3>ğŸ“ LOG:</h3>
            <div id="log"></div>
        </div>
    </div>

    <script>
        // ==================== DATENBANK ====================
        let database = {
            balance: 5000,
            transactions: [],
            lastUpdated: new Date().toISOString()
        };
        
        // ==================== HELPER FUNCTIONS ====================
        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.textContent = `[${time}] ${message}`;
            logDiv.appendChild(entry);
            console.log(message);
        }
        
        function updateDisplay() {
            // Balance aktualisieren
            document.getElementById('balance').textContent = `${database.balance} $`;
            
            // Transaktionen anzeigen
            const transactionsList = document.getElementById('transactionsList');
            transactionsList.innerHTML = '';
            
            database.transactions.slice(-10).reverse().forEach(trans => {
                const div = document.createElement('div');
                div.className = 'transaction';
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong style="font-size: 1.5rem; color: #fbbf24;">${trans.amount} $</strong>
                            <div style="color: #94a3b8; font-size: 0.9rem;">
                                ${trans.type === 'hold' ? 'â¸ï¸ ZurÃ¼ckgehalten' : 
                                  trans.type === 'deposit' ? 'â• Eingezahlt' : 'â– Ausgezahlt'}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div>${trans.date}</div>
                            <div style="color: ${trans.status === 'pending' ? '#f59e0b' : '#10b981'};">
                                ${trans.status === 'pending' ? 'â³ Ausstehend' : 'âœ… Freigegeben'}
                            </div>
                        </div>
                    </div>
                `;
                transactionsList.appendChild(div);
            });
            
            log(`Balance aktualisiert: ${database.balance}$`);
        }
        
        // ==================== TRANSACTION FUNCTIONS ====================
        function addHold(amount) {
            const today = new Date();
            const releaseDate = new Date(today);
            releaseDate.setDate(releaseDate.getDate() + 2);
            
            const transaction = {
                id: Date.now(),
                amount: amount,
                type: 'hold',
                status: 'pending',
                date: today.toLocaleDateString('de-DE'),
                purchaseDate: today.toISOString().split('T')[0],
                releaseDate: releaseDate.toISOString().split('T')[0],
                createdAt: new Date().toISOString()
            };
            
            database.transactions.push(transaction);
            log(`âœ… ${amount}$ zurÃ¼ckgehalten (Freigabe: ${releaseDate.toLocaleDateString('de-DE')})`);
            updateDisplay();
            saveData();
        }
        
        function addDeposit(amount) {
            database.balance += amount;
            
            const transaction = {
                id: Date.now(),
                amount: amount,
                type: 'deposit',
                status: 'released',
                date: new Date().toLocaleDateString('de-DE'),
                createdAt: new Date().toISOString()
            };
            
            database.transactions.push(transaction);
            log(`âœ… ${amount}$ eingezahlt. Neue Balance: ${database.balance}$`);
            updateDisplay();
            saveData();
        }
        
        function addWithdraw(amount) {
            if (amount > database.balance) {
                log(`âŒ Nicht genug Guthaben! VerfÃ¼gbar: ${database.balance}$`);
                alert(`âŒ Nicht genug Guthaben!\nVerfÃ¼gbar: ${database.balance}$`);
                return;
            }
            
            database.balance -= amount;
            
            const transaction = {
                id: Date.now(),
                amount: amount,
                type: 'withdrawal',
                status: 'released',
                date: new Date().toLocaleDateString('de-DE'),
                createdAt: new Date().toISOString()
            };
            
            database.transactions.push(transaction);
            log(`âœ… ${amount}$ ausgezahlt. Neue Balance: ${database.balance}$`);
            updateDisplay();
            saveData();
        }
        
        // ==================== DATEN SPEICHERN/LADEN ====================
        function saveData() {
            try {
                // In localStorage speichern
                localStorage.setItem('ccshop_database', JSON.stringify(database));
                log('ğŸ’¾ Daten lokal gespeichert');
                
                // Als Datei speichern (optional)
                const dataStr = JSON.stringify(database, null, 2);
                localStorage.setItem('ccshop_backup', dataStr);
                
            } catch (error) {
                log(`âŒ Fehler beim Speichern: ${error.message}`);
            }
        }
        
        function loadData() {
            try {
                const saved = localStorage.getItem('ccshop_database');
                if (saved) {
                    database = JSON.parse(saved);
                    log(`ğŸ“‚ Daten geladen: ${database.transactions.length} Transaktionen`);
                    updateDisplay();
                } else {
                    log('â„¹ï¸ Keine gespeicherten Daten gefunden');
                }
            } catch (error) {
                log(`âŒ Fehler beim Laden: ${error.message}`);
            }
        }
        
        function exportData() {
            const dataStr = JSON.stringify(database, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            // Download Link erstellen
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `ccshop_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            log('ğŸ“¤ Daten exportiert als JSON Datei');
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        database = importedData;
                        log(`ğŸ“¥ Daten importiert: ${database.transactions.length} Transaktionen`);
                        updateDisplay();
                        saveData();
                        alert('âœ… Daten erfolgreich importiert!');
                    } catch (error) {
                        log(`âŒ Fehler beim Import: ${error.message}`);
                        alert('âŒ UngÃ¼ltige JSON Datei!');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // ==================== AUTOMATISCHE FUNKTIONEN ====================
        function checkPendingReleases() {
            const today = new Date().toISOString().split('T')[0];
            let releasedCount = 0;
            
            database.transactions.forEach(trans => {
                if (trans.status === 'pending' && trans.releaseDate && trans.releaseDate <= today) {
                    trans.status = 'released';
                    database.balance += trans.amount;
                    releasedCount++;
                    log(`ğŸ‰ ${trans.amount}$ freigegeben!`);
                }
            });
            
            if (releasedCount > 0) {
                log(`âœ… ${releasedCount} BetrÃ¤ge automatisch freigegeben`);
                updateDisplay();
                saveData();
            }
        }
        
        // ==================== INITIALISIERUNG ====================
        function init() {
            log('ğŸš€ CC-Shop Finanzsystem gestartet');
            loadData();
            checkPendingReleases();
            updateDisplay();
            
            // Alle 5 Minuten auf Freigaben prÃ¼fen
            setInterval(checkPendingReleases, 5 * 60 * 1000);
            
            // Automatisch alle 30 Sekunden speichern
            setInterval(saveData, 30 * 1000);
            
            log('âœ… System bereit!');
        }
        
        // Starte das System
        init();
        
        // FÃ¼r manuelle Eingaben in Console
        window.db = database;
        window.addTransaction = (amount, type) => {
            if (type === 'hold') addHold(amount);
            else if (type === 'deposit') addDeposit(amount);
            else if (type === 'withdraw') addWithdraw(amount);
        };
    </script>
</body>
</html>

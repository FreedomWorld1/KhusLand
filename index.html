<!DOCTYPE html>
<html>
<head>
    <title>CC-Shop ohne Firebase SDK</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 20px; margin: 20px 0; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        button { padding: 10px 20px; margin: 5px; background: #4285f4; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè™ CC-Shop Finanzsystem (ohne Firebase SDK)</h1>
        
        <div class="card">
            <h3>Status</h3>
            <div id="status">Nicht verbunden</div>
        </div>
        
        <div class="card">
            <h3>Aktionen</h3>
            <button onclick="testConnection()">üîó Verbindung testen</button>
            <button onclick="createData()">‚ûï Daten erstellen</button>
            <button onclick="readData()">üìñ Daten lesen</button>
            <button onclick="saveTransaction()">üí∏ Transaktion speichern</button>
        </div>
        
        <div class="card">
            <h3>Debug Info</h3>
            <div id="debug"></div>
        </div>
    </div>
    
    <script>
        // Firebase URL
        const FIREBASE_DB_URL = 'https://cc-shop-36c3b-default-rtdb.europe-west1.firebasedatabase.app';
        
        // Helper Funktionen
        function log(message, type = 'info') {
            const debugDiv = document.getElementById('debug');
            const time = new Date().toLocaleTimeString();
            const msg = document.createElement('div');
            msg.className = type;
            msg.textContent = `[${time}] ${message}`;
            debugDiv.appendChild(msg);
            console.log(`[${type}]`, message);
        }
        
        async function firebaseRequest(path, method = 'GET', data = null) {
            const url = `${FIREBASE_DB_URL}${path}.json`;
            
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                }
            };
            
            if (data) {
                options.body = JSON.stringify(data);
            }
            
            try {
                const response = await fetch(url, options);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                log(`Fehler bei ${method} ${path}: ${error.message}`, 'error');
                throw error;
            }
        }
        
        // Hauptfunktionen
        async function testConnection() {
            try {
                log('Teste Firebase Verbindung...', 'info');
                document.getElementById('status').textContent = 'Verbindung wird getestet...';
                
                // Test schreiben
                const writeResult = await firebaseRequest('/test', 'PUT', {
                    timestamp: new Date().toISOString(),
                    message: 'Verbindungstest CC-Shop'
                });
                
                log(`‚úÖ Test geschrieben: ${JSON.stringify(writeResult)}`, 'success');
                
                // Test lesen
                const readResult = await firebaseRequest('/test', 'GET');
                log(`‚úÖ Test gelesen: ${JSON.stringify(readResult)}`, 'success');
                
                // Test l√∂schen
                await firebaseRequest('/test', 'DELETE');
                log('‚úÖ Test gel√∂scht', 'info');
                
                document.getElementById('status').innerHTML = '<span style="color:green">‚úÖ Verbunden mit Firebase!</span>';
                
            } catch (error) {
                document.getElementById('status').innerHTML = `<span style="color:red">‚ùå Fehler: ${error.message}</span>`;
                log(`‚ùå Verbindungstest fehlgeschlagen: ${error.message}`, 'error');
                
                // Zeige L√∂sung
                if (error.message.includes('Failed to fetch') || error.message.includes('CORS')) {
                    log('‚ö†Ô∏è L√∂sung: √Ñndere Firebase Database Rules:', 'warning');
                    log('1. Gehe zu Firebase Console ‚Üí Realtime Database ‚Üí Rules', 'warning');
                    log('2. √Ñndere zu: { "rules": { ".read": true, ".write": true } }', 'warning');
                    log('3. Klicke "PUBLISH"', 'warning');
                }
            }
        }
        
        async function createData() {
            try {
                // Erstelle Balance
                await firebaseRequest('/balance', 'PUT', {
                    amount: 10000,
                    currency: 'USD',
                    lastUpdated: new Date().toISOString()
                });
                
                // Erstelle Transaktionen
                const today = new Date().toISOString().split('T')[0];
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowStr = tomorrow.toISOString().split('T')[0];
                
                const transactions = [
                    {
                        amount: 1000,
                        type: 'hold',
                        status: 'pending',
                        purchaseDate: today,
                        releaseDate: tomorrowStr,
                        createdAt: new Date().toISOString()
                    },
                    {
                        amount: 500,
                        type: 'deposit',
                        status: 'released',
                        purchaseDate: today,
                        releaseDate: today,
                        createdAt: new Date().toISOString()
                    }
                ];
                
                // Transaktionen speichern
                for (let i = 0; i < transactions.length; i++) {
                    await firebaseRequest(`/transactions/t${Date.now()}${i}`, 'PUT', transactions[i]);
                }
                
                log('‚úÖ Testdaten erfolgreich erstellt!', 'success');
                alert('‚úÖ Testdaten in Firebase gespeichert!');
                
            } catch (error) {
                log(`‚ùå Fehler beim Erstellen: ${error.message}`, 'error');
            }
        }
        
        async function readData() {
            try {
                const balance = await firebaseRequest('/balance', 'GET');
                const transactions = await firebaseRequest('/transactions', 'GET');
                
                log(`üìä Balance: ${balance?.amount || 0} $`, 'info');
                log(`üìä Transaktionen: ${transactions ? Object.keys(transactions).length : 0}`, 'info');
                
                if (transactions) {
                    Object.entries(transactions).forEach(([key, value]) => {
                        log(`- ${value.amount}$ (${value.type}, ${value.status})`, 'info');
                    });
                }
                
            } catch (error) {
                log(`‚ùå Fehler beim Lesen: ${error.message}`, 'error');
            }
        }
        
        async function saveTransaction() {
            const amount = prompt('Betrag in $:');
            if (!amount || isNaN(amount)) {
                alert('Ung√ºltiger Betrag!');
                return;
            }
            
            try {
                const transactionId = `trans_${Date.now()}`;
                const today = new Date().toISOString().split('T')[0];
                
                await firebaseRequest(`/transactions/${transactionId}`, 'PUT', {
                    amount: parseInt(amount),
                    type: 'hold',
                    status: 'pending',
                    purchaseDate: today,
                    releaseDate: today,
                    createdAt: new Date().toISOString(),
                    description: 'Manuelle Transaktion'
                });
                
                log(`‚úÖ Transaktion ${amount}$ gespeichert (ID: ${transactionId})`, 'success');
                alert(`‚úÖ ${amount}$ erfolgreich gespeichert!`);
                
            } catch (error) {
                log(`‚ùå Fehler beim Speichern: ${error.message}`, 'error');
            }
        }
        
        // Automatisch testen
        window.onload = testConnection;
    </script>
</body>
</html>

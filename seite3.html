<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Materialrecycler - Produkte</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { 
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #1c1917 0%, #292524 100%);
    }
    .card { 
      background: linear-gradient(135deg, rgba(41, 37, 36, 0.8) 0%, rgba(28, 25, 23, 0.9) 100%); 
      border: 1px solid rgba(245, 158, 11, 0.3); 
      border-radius: 16px; 
      backdrop-filter: blur(10px);
    }
    .shadow-soft { 
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5), 
                  0 5px 10px rgba(0, 0, 0, 0.3),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1); 
    }
    .small-muted { 
      color: #a8a29e; 
      font-size: 0.85rem; 
    }
    .btn { 
      transition: all 0.2s ease; 
      font-size: 0.9rem; 
      font-weight: 500;
    }
    .btn:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    .hidden-el { 
      display: none !important; 
    }
    input, select, textarea { 
      transition: all 0.2s ease; 
      font-size: 0.95rem; 
    }
    input:focus, select:focus, textarea:focus { 
      outline: none; 
      border-color: #f59e0b; 
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.3); 
    }
    .active-link { 
      background-color: #d97706 !important; 
      color: #fff !important; 
      font-weight: 600; 
    }
    .gradient-text {
      background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .glass-effect {
      background: rgba(41, 37, 36, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(245, 158, 11, 0.2);
    }
    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .pulse-glow {
      animation: pulseGlow 2s infinite;
    }
    @keyframes pulseGlow {
      0% { box-shadow: 0 0 5px rgba(245, 158, 11, 0.5); }
      50% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.8); }
      100% { box-shadow: 0 0 5px rgba(245, 158, 11, 0.5); }
    }
    .scrollbar-custom::-webkit-scrollbar {
      width: 6px;
    }
    .scrollbar-custom::-webkit-scrollbar-track {
      background: rgba(41, 37, 36, 0.5);
      border-radius: 10px;
    }
    .scrollbar-custom::-webkit-scrollbar-thumb {
      background: #f59e0b;
      border-radius: 10px;
    }
    .hamburger-container {
      position: relative;
      z-index: 1000;
    }
    .hamburger-menu {
      z-index: 1001;
    }
    .product-item {
      transition: all 0.2s ease;
    }
    .product-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .product-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .image-preview {
      max-width: 100%;
      max-height: 200px;
      border-radius: 8px;
      margin-top: 10px;
      display: none;
    }
    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
      width: 100%;
    }
    .file-input-wrapper input[type=file] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    /* GE√ÑNDERT: Nur 2 Spalten auch bei gro√üen Bildschirmen */
    .product-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
    @media (min-width: 768px) {
      .product-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    /* ENTFERNT: repeat(3, 1fr) f√ºr gro√üe Bildschirme */
    .product-card {
      display: grid;
      grid-template-columns: 100px 1fr;
      gap: 1rem;
      align-items: start;
    }
    .resource-tag {
      display: inline-flex;
      align-items: center;
      background: rgba(147, 51, 234, 0.2);
      color: #a855f7;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      margin: 2px;
    }
    .resource-input-container {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }
    .resource-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 8px;
    }
    .resource-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      padding: 8px;
      background: rgba(245, 158, 11, 0.1);
      border-radius: 8px;
    }
    .resource-range {
      color: #f59e0b;
      font-weight: 600;
    }
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 12px 0;
    }
    .quantity-btn {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      background: rgba(245, 158, 11, 0.2);
      border: 1px solid rgba(245, 158, 11, 0.3);
      color: #f59e0b;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .quantity-btn:hover {
      background: rgba(245, 158, 11, 0.3);
      transform: scale(1.05);
    }
    .quantity-input {
      width: 80px;
      text-align: center;
      padding: 6px 8px;
      border-radius: 6px;
      background: rgba(41, 37, 36, 0.5);
      border: 1px solid rgba(245, 158, 11, 0.3);
      color: #f59e0b;
      font-weight: 600;
    }
    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: rgba(245, 158, 11, 0.1);
      border-radius: 8px;
      margin-bottom: 6px;
      font-size: 0.9rem;
    }
    .result-range {
      color: #f59e0b;
      font-weight: 600;
    }
    .calculator-section {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid rgba(245, 158, 11, 0.2);
    }
    .calculator-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #f59e0b;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .search-type-selector {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    .search-type-btn {
      padding: 6px 12px;
      border-radius: 8px;
      background: rgba(245, 158, 11, 0.2);
      color: #f59e0b;
      border: 1px solid rgba(245, 158, 11, 0.3);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.85rem;
    }
    .search-type-btn.active {
      background: rgba(245, 158, 11, 0.6);
      color: white;
      font-weight: 600;
    }
    .search-type-btn:hover {
      background: rgba(245, 158, 11, 0.4);
    }
  </style>
</head>
<body class="text-amber-50 antialiased min-h-screen">
  
  <!-- MAIN CONTENT -->
  <div id="mainContent">
    <div class="max-w-6xl mx-auto p-4 md:p-6">

      <!-- HEADER -->
      <header class="glass-effect rounded-2xl shadow-soft mb-6 p-4 md:p-6 flex justify-between items-center relative z-10">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-full bg-gradient-to-r from-amber-600 to-amber-500 flex items-center justify-center">
            <span class="text-white font-bold">üè≠</span>
          </div>
          <h1 class="text-2xl md:text-3xl font-bold gradient-text tracking-tight">Materialrecycler</h1>
        </div>
        <div class="flex items-center gap-2">
          <button id="btnProducts" class="btn px-3 py-2 bg-amber-600 hover:bg-amber-500 rounded-lg shadow-sm pulse-glow">Produkte</button>
          <button id="btnAdmin" class="btn px-3 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg shadow-sm">Admin</button>
          <div class="hamburger-container">
            <button id="hamburgerBtn" class="p-2 flex flex-col justify-between h-6 w-8 focus:outline-none ml-1 rounded-md bg-amber-900/50 hover:bg-amber-800/50">
              <span class="block h-0.5 bg-amber-100 rounded-full"></span>
              <span class="block h-0.5 bg-amber-100 rounded-full"></span>
              <span class="block h-0.5 bg-amber-100 rounded-full"></span>
            </button>
            <div id="hamburgerMenu" class="hamburger-menu hidden absolute right-0 mt-2 w-44 glass-effect border border-amber-700 rounded-lg shadow-lg overflow-hidden">
              <a href="index.html" class="block px-4 py-3 hover:bg-amber-800/50 transition-colors">Weed</a>
              <a href="seite2.html" class="block px-4 py-3 hover:bg-amber-800/50 transition-colors">Kokain</a>
              <a href="https://khusland.github.io/KhusLand2/" class="block px-4 py-3 hover:bg-amber-800/50 transition-colors">30% Rechner</a>
              <a href="seite4.html" class="block px-4 py-3 hover:bg-gray-700 transition-colors">Herstellung</a>
              <a href="seite3.html" class="block px-4 py-3 hover:bg-amber-800/50 active-link transition-colors">Materialrecycler</a>
              <a href="seite5.html" class="block px-4 py-3 hover:bg-gray-700 transition-colors">Routen</a>
            </div>
          </div>
        </div>
      </header>

      <div id="mainContainer" class="space-y-6 relative z-0">

        <!-- SUCHLEISTE -->
        <div class="card p-4 shadow-soft">
          <div class="relative">
            <input type="text" id="searchInput" placeholder="Ressourcen suchen..." class="w-full p-4 rounded-lg bg-amber-900/20 border border-amber-800 focus:border-amber-500 pl-12">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-400 absolute left-4 top-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
        </div>

        <!-- PRODUKTE -->
        <div id="productsSection" class="card p-6 shadow-soft fade-in">
          <h2 class="text-xl font-semibold mb-4 text-amber-400 flex items-center gap-2">
            <span class="bg-amber-900/30 p-2 rounded-lg">üì¶</span>
             Produkte
          </h2>
          
          <!-- Products Grid -->
          <div id="productsGrid" class="product-grid">
            <!-- Produkte werden hier dynamisch geladen -->
          </div>
        </div>

        <!-- ADMIN -->
        <div id="adminPanel" class="card p-5 shadow-soft hidden-el fade-in">
          <h2 class="text-lg font-semibold mb-4 text-blue-400 flex items-center gap-2">
            <span class="bg-blue-900/30 p-2 rounded-lg">üîê</span>
            Adminbereich
          </h2>
          <div id="adminLoginSection">
            <div class="mb-4">
              <label for="adminPass" class="block text-sm font-medium text-amber-300 mb-1">Admin-Passwort</label>
              <input id="adminPass" type="password" placeholder="Geben Sie das Passwort ein" class="w-full p-3 rounded-lg bg-amber-900/20 border border-amber-800 focus:border-blue-500"/>
            </div>
            <button id="adminLoginBtn" class="w-full py-3 bg-blue-600 hover:bg-blue-500 rounded-lg btn font-medium flex items-center justify-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
              </svg>
              Einloggen
            </button>
            <span id="adminError" class="text-red-400 mt-3 block hidden-el text-center text-sm py-2 bg-red-900/20 rounded-lg">‚ùå Falsches Passwort</span>
          </div>
          <div id="adminContent" class="hidden-el">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4 p-3 rounded-lg bg-amber-900/20">
              <div class="small-muted">Produkte: <span id="totalProducts" class="font-bold text-amber-50">0</span></div>
              <div class="flex gap-2">
                <button id="addProductBtn" class="px-4 py-3 bg-amber-600 hover:bg-amber-500 rounded-lg btn font-medium flex items-center justify-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                  </svg>
                  Produkt
                </button>
              </div>
            </div>
            
            <!-- Admin-Suchleiste -->
            <div class="mb-4">
              <div class="relative">
                <input type="text" id="adminSearchInput" placeholder="Produkt in Adminbereich suchen..." class="w-full p-3 rounded-lg bg-amber-900/20 border border-amber-800 focus:border-blue-500 pl-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-amber-400 absolute left-3 top-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
              </div>
            </div>
            
            <div class="overflow-auto max-h-[50vh] rounded-lg border border-amber-800 scrollbar-custom">
              <table class="w-full text-left text-sm">
                <thead class="text-amber-400 bg-amber-900/50 sticky top-0">
                  <tr>
                    <th class="p-3 font-medium">Name</th>
                    <th class="p-3 font-medium">Ressourcen</th>
                    <th class="p-3 font-medium">Aktion</th>
                  </tr>
                </thead>
                <tbody id="adminTableBody" class="divide-y divide-amber-800"></tbody>
              </table>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Modal f√ºr Produkt hinzuf√ºgen -->
    <div id="productModal" class="modal-overlay hidden-el">
      <div class="card p-6 m-4 max-w-md w-full shadow-soft">
        <h3 class="text-lg font-semibold mb-4 text-amber-400" id="productModalTitle">Produkt hinzuf√ºgen</h3>
        <form id="productForm" class="space-y-4">
          <input type="hidden" id="productKey">
          <div>
            <label class="block text-sm font-medium text-amber-300 mb-1">Name</label>
            <input type="text" id="productName" class="p-3 rounded-lg bg-amber-900/20 border border-amber-800 w-full focus:border-amber-500" placeholder="z.B.: Aluminium-Dose" required/>
          </div>
          <div>
            <label class="block text-sm font-medium text-amber-300 mb-1">Ressourcen</label>
            <div class="resource-input-container">
              <input type="text" id="newResourceName" class="flex-1 p-3 rounded-lg bg-amber-900/20 border border-amber-800 focus:border-purple-500" placeholder="Ressourcenname"/>
              <input type="number" id="newResourceMin" class="w-20 p-3 rounded-lg bg-amber-900/20 border border-amber-800 focus:border-purple-500" placeholder="Min" min="1"/>
              <input type="number" id="newResourceMax" class="w-20 p-3 rounded-lg bg-amber-900/20 border border-amber-800 focus:border-purple-500" placeholder="Max" min="1"/>
              <button type="button" id="addResourceBtn" class="px-4 py-3 bg-purple-600 hover:bg-purple-500 rounded-lg btn font-medium">+</button>
            </div>
            <div id="resourcesList" class="resource-list">
              <!-- Ressourcen werden hier dynamisch hinzugef√ºgt -->
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-amber-300 mb-1">Bild hochladen</label>
            <div class="file-input-wrapper">
              <button type="button" class="w-full p-3 rounded-lg bg-amber-900/20 border border-amber-800 hover:bg-amber-800/30 flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                Bild ausw√§hlen
              </button>
              <input type="file" id="productImageFile" accept="image/*" class="file-input">
            </div>
            <div class="text-xs text-amber-500 mt-1">Unterst√ºtzte Formate: JPG, PNG, GIF (max. 5MB)</div>
            <img id="imagePreview" class="image-preview" alt="Vorschau">
            <input type="hidden" id="productImageData">
          </div>
          <div class="flex gap-3 pt-2">
            <button type="submit" class="flex-1 px-4 py-3 bg-amber-600 hover:bg-amber-500 rounded-lg btn font-medium">Speichern</button>
            <button type="button" id="cancelProduct" class="px-4 py-3 bg-amber-900/50 hover:bg-amber-800/50 rounded-lg btn font-medium">Abbrechen</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Utility
    function show(el) { 
      el.classList.remove('hidden-el'); 
      el.classList.add('fade-in');
    }
    function hide(el) { 
      el.classList.add('hidden-el'); 
      el.classList.remove('fade-in');
    }

    // Globale Variablen
    let products = [];
    const ADMIN_PASSWORD = '1101';
    let currentResources = [];

    // Bild zu Base64 konvertieren
    function convertImageToBase64(file, callback) {
      const reader = new FileReader();
      reader.onload = function(e) {
        callback(e.target.result);
      };
      reader.readAsDataURL(file);
    }

    // Daten aus LocalStorage laden
    function loadDataFromStorage() {
      const savedProducts = localStorage.getItem('materialrecycler_products');
      
      if (savedProducts) {
        products = JSON.parse(savedProducts);
      }
    }

    // Daten in LocalStorage speichern
    function saveDataToStorage() {
      localStorage.setItem('materialrecycler_products', JSON.stringify(products));
    }

    // Hamburger Menu
    document.getElementById('hamburgerBtn').addEventListener('click', (e) => {
      e.stopPropagation();
      document.getElementById('hamburgerMenu').classList.toggle('hidden');
    });

    // Close hamburger menu when clicking outside
    document.addEventListener('click', (e) => {
      const hamburgerMenu = document.getElementById('hamburgerMenu');
      const hamburgerBtn = document.getElementById('hamburgerBtn');
      
      if (!hamburgerMenu.contains(e.target) && !hamburgerBtn.contains(e.target)) {
        hamburgerMenu.classList.add('hidden');
      }
    });

    // Tabs Navigation
    document.getElementById('btnProducts').addEventListener('click', () => {
      show(document.getElementById('productsSection')); 
      hide(document.getElementById('adminPanel'));
      updateButtonStates('products');
    });
    
    document.getElementById('btnAdmin').addEventListener('click', () => {
      hide(document.getElementById('productsSection')); 
      show(document.getElementById('adminPanel'));
      updateButtonStates('admin');
    });

    function updateButtonStates(activeButton) {
      const buttons = {
        products: document.getElementById('btnProducts'),
        admin: document.getElementById('btnAdmin')
      };
      
      Object.values(buttons).forEach(btn => {
        btn.classList.remove('pulse-glow', 'bg-amber-600', 'bg-blue-600');
        btn.classList.add('bg-amber-900/50');
      });
      
      if (buttons[activeButton]) {
        buttons[activeButton].classList.remove('bg-amber-900/50');
        if (activeButton === 'products') {
          buttons[activeButton].classList.add('bg-amber-600', 'pulse-glow');
        } else if (activeButton === 'admin') {
          buttons[activeButton].classList.add('bg-blue-600');
        }
      }
    }

    // Produkte rendern
    function renderProducts() {
      const productsGrid = document.getElementById('productsGrid');
      productsGrid.innerHTML = '';
      
      if (products.length === 0) {
        productsGrid.innerHTML = '<div class="col-span-full text-center py-8 text-amber-400"><p>Keine Produkte vorhanden.</p></div>';
        return;
      }
      
      products.forEach(product => {
        const el = document.createElement('div');
        el.className = 'product-item p-4 rounded-lg bg-amber-900/20 border border-amber-800 hover:border-amber-500/30 transition-all duration-200';
        
        let imageHtml = '';
        if (product.imageData) {
          imageHtml = `<img src="${product.imageData}" alt="${product.name}" class="product-image">`;
        } else {
          imageHtml = `<div class="product-image bg-amber-800/50 flex items-center justify-center text-amber-400">Kein Bild</div>`;
        }
        
        // Ressourcen f√ºr dieses Produkt
        let resourcesHtml = '';
        if (product.resources && product.resources.length > 0) {
          resourcesHtml = product.resources.map(resource => 
            `<span class="resource-tag">${resource.name} (${resource.min}-${resource.max})</span>`
          ).join('');
        }
        
        el.innerHTML = `
          <div class="product-card">
            <div class="flex-shrink-0">
              ${imageHtml}
            </div>
            <div class="flex-grow">
              <div class="font-semibold text-lg mb-2">${product.name}</div>
              ${resourcesHtml ? `<div class="resource-list mb-3">${resourcesHtml}</div>` : ''}
              
              <!-- Ressourcen Rechner -->
              <div class="calculator-section">
                <div class="calculator-title">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V4a2 2 0 00-2-2H6zm1 2a1 1 0 000 2h6a1 1 0 100-2H7zm6 7a1 1 0 011 1v3a1 1 0 11-2 0v-3a1 1 0 011-1zm-3 3a1 1 0 100 2h.01a1 1 0 100-2H10zm-4 1a1 1 0 011-1h.01a1 1 0 110 2H7a1 1 0 01-1-1zm1-4a1 1 0 100 2h.01a1 1 0 100-2H7zm2 1a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1zm4-4a1 1 0 100 2h.01a1 1 0 100-2H13z" clip-rule="evenodd" />
                  </svg>
                  Ressourcen Rechner
                </div>
                
                <div class="quantity-controls">
                  <button class="quantity-btn decrease-quantity">-</button>
                  <input type="number" value="1" min="1" class="quantity-input product-quantity">
                  <button class="quantity-btn increase-quantity">+</button>
                  <span class="text-amber-300 ml-2 text-sm">Produkt(e)</span>
                </div>
                
                <div class="calculation-results">
                  <!-- Ergebnisse werden hier dynamisch eingef√ºgt -->
                </div>
              </div>
            </div>
          </div>
        `;
        productsGrid.appendChild(el);
        
        // Event Listener f√ºr Quantity Controls
        const quantityInput = el.querySelector('.product-quantity');
        const decreaseBtn = el.querySelector('.decrease-quantity');
        const increaseBtn = el.querySelector('.increase-quantity');
        const resultsContainer = el.querySelector('.calculation-results');
        
        // Berechnung f√ºr dieses Produkt
        const updateCalculation = () => {
          const quantity = parseInt(quantityInput.value) || 1;
          resultsContainer.innerHTML = '';
          
          // Nur die Ressourcen dieses spezifischen Produkts verwenden
          const productResources = product.resources || [];
          
          if (productResources.length === 0) {
            resultsContainer.innerHTML = '<div class="text-amber-400 text-center py-2 text-sm">Keine Ressourcen f√ºr dieses Produkt definiert</div>';
            return;
          }
          
          productResources.forEach(resource => {
            const minTotal = resource.min * quantity;
            const maxTotal = resource.max * quantity;
            
            const resultEl = document.createElement('div');
            resultEl.className = 'result-item';
            resultEl.innerHTML = `
              <div class="flex-1 font-medium text-sm">${resource.name}</div>
              <div class="result-range text-sm">${minTotal}-${maxTotal}</div>
            `;
            resultsContainer.appendChild(resultEl);
          });
        };
        
        // Initiale Berechnung
        updateCalculation();
        
        // Event Listener
        decreaseBtn.addEventListener('click', () => {
          const current = parseInt(quantityInput.value) || 1;
          if (current > 1) {
            quantityInput.value = current - 1;
            updateCalculation();
          }
        });

        increaseBtn.addEventListener('click', () => {
          const current = parseInt(quantityInput.value) || 1;
          quantityInput.value = current + 1;
          updateCalculation();
        });

        quantityInput.addEventListener('input', () => {
          updateCalculation();
        });
      });
    }

    // Suchfunktion - nur nach Ressourcen
    document.getElementById('searchInput').addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      
      if (searchTerm === '') {
        renderProducts();
        return;
      }
      
      // Nur nach Ressourcen suchen
      const filteredProducts = products.filter(product => 
        product.resources && product.resources.some(resource => 
          resource.name.toLowerCase().includes(searchTerm)
        )
      );
      
      const productsGrid = document.getElementById('productsGrid');
      productsGrid.innerHTML = '';
      
      if (filteredProducts.length === 0) {
        productsGrid.innerHTML = '<div class="col-span-full text-center py-8 text-amber-400"><p>Keine Produkte mit dieser Ressource gefunden.</p></div>';
        return;
      }
      
      filteredProducts.forEach(product => {
        const el = document.createElement('div');
        el.className = 'product-item p-4 rounded-lg bg-amber-900/20 border border-amber-800 hover:border-amber-500/30 transition-all duration-200';
        
        let imageHtml = '';
        if (product.imageData) {
          imageHtml = `<img src="${product.imageData}" alt="${product.name}" class="product-image">`;
        } else {
          imageHtml = `<div class="product-image bg-amber-800/50 flex items-center justify-center text-amber-400">Kein Bild</div>`;
        }
        
        // Ressourcen f√ºr dieses Produkt
        let resourcesHtml = '';
        if (product.resources && product.resources.length > 0) {
          resourcesHtml = product.resources.map(resource => 
            `<span class="resource-tag">${resource.name} (${resource.min}-${resource.max})</span>`
          ).join('');
        }
        
        el.innerHTML = `
          <div class="product-card">
            <div class="flex-shrink-0">
              ${imageHtml}
            </div>
            <div class="flex-grow">
              <div class="font-semibold text-lg mb-2">${product.name}</div>
              ${resourcesHtml ? `<div class="resource-list mb-3">${resourcesHtml}</div>` : ''}
              
              <!-- Ressourcen Rechner -->
              <div class="calculator-section">
                <div class="calculator-title">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V4a2 2 0 00-2-2H6zm1 2a1 1 0 000 2h6a1 1 0 100-2H7zm6 7a1 1 0 011 1v3a1 1 0 11-2 0v-3a1 1 0 011-1zm-3 3a1 1 0 100 2h.01a1 1 0 100-2H10zm-4 1a1 1 0 011-1h.01a1 1 0 110 2H7a1 1 0 01-1-1zm1-4a1 1 0 100 2h.01a1 1 0 100-2H7zm2 1a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1zm4-4a1 1 0 100 2h.01a1 1 0 100-2H13z" clip-rule="evenodd" />
                  </svg>
                  Ressourcen Rechner
                </div>
                
                <div class="quantity-controls">
                  <button class="quantity-btn decrease-quantity">-</button>
                  <input type="number" value="1" min="1" class="quantity-input product-quantity">
                  <button class="quantity-btn increase-quantity">+</button>
                  <span class="text-amber-300 ml-2 text-sm">Produkt(e)</span>
                </div>
                
                <div class="calculation-results">
                  <!-- Ergebnisse werden hier dynamisch eingef√ºgt -->
                </div>
              </div>
            </div>
          </div>
        `;
        productsGrid.appendChild(el);
        
        // Event Listener f√ºr Quantity Controls
        const quantityInput = el.querySelector('.product-quantity');
        const decreaseBtn = el.querySelector('.decrease-quantity');
        const increaseBtn = el.querySelector('.increase-quantity');
        const resultsContainer = el.querySelector('.calculation-results');
        
        // Berechnung f√ºr dieses Produkt
        const updateCalculation = () => {
          const quantity = parseInt(quantityInput.value) || 1;
          resultsContainer.innerHTML = '';
          
          // Nur die Ressourcen dieses spezifischen Produkts verwenden
          const productResources = product.resources || [];
          
          if (productResources.length === 0) {
            resultsContainer.innerHTML = '<div class="text-amber-400 text-center py-2 text-sm">Keine Ressourcen f√ºr dieses Produkt definiert</div>';
            return;
          }
          
          productResources.forEach(resource => {
            const minTotal = resource.min * quantity;
            const maxTotal = resource.max * quantity;
            
            const resultEl = document.createElement('div');
            resultEl.className = 'result-item';
            resultEl.innerHTML = `
              <div class="flex-1 font-medium text-sm">${resource.name}</div>
              <div class="result-range text-sm">${minTotal}-${maxTotal}</div>
            `;
            resultsContainer.appendChild(resultEl);
          });
        };
        
        // Initiale Berechnung
        updateCalculation();
        
        // Event Listener
        decreaseBtn.addEventListener('click', () => {
          const current = parseInt(quantityInput.value) || 1;
          if (current > 1) {
            quantityInput.value = current - 1;
            updateCalculation();
          }
        });

        increaseBtn.addEventListener('click', () => {
          const current = parseInt(quantityInput.value) || 1;
          quantityInput.value = current + 1;
          updateCalculation();
        });

        quantityInput.addEventListener('input', () => {
          updateCalculation();
        });
      });
    });

    // Adminbereich
    const adminLoginBtn = document.getElementById('adminLoginBtn');
    const adminPassInput = document.getElementById('adminPass');
    const adminError = document.getElementById('adminError');
    const adminTableBody = document.getElementById('adminTableBody');
    const totalProducts = document.getElementById('totalProducts');
    const addProductBtn = document.getElementById('addProductBtn');
    
    // Modal Elemente
    const productModal = document.getElementById('productModal');
    const productForm = document.getElementById('productForm');
    const productModalTitle = document.getElementById('productModalTitle');
    const productKeyInput = document.getElementById('productKey');
    const cancelProduct = document.getElementById('cancelProduct');
    const productImageFile = document.getElementById('productImageFile');
    const imagePreview = document.getElementById('imagePreview');
    const productImageData = document.getElementById('productImageData');
    
    // Ressourcen Elemente
    const newResourceName = document.getElementById('newResourceName');
    const newResourceMin = document.getElementById('newResourceMin');
    const newResourceMax = document.getElementById('newResourceMax');
    const addResourceBtn = document.getElementById('addResourceBtn');
    const resourcesList = document.getElementById('resourcesList');

    // Ressource hinzuf√ºgen
    addResourceBtn.addEventListener('click', () => {
      const resourceName = newResourceName.value.trim();
      const resourceMin = parseInt(newResourceMin.value);
      const resourceMax = parseInt(newResourceMax.value);
      
      if (resourceName && resourceMin && resourceMax && resourceMin <= resourceMax) {
        currentResources.push({
          name: resourceName,
          min: resourceMin,
          max: resourceMax
        });
        renderResourcesList();
        newResourceName.value = '';
        newResourceMin.value = '';
        newResourceMax.value = '';
        newResourceName.focus();
      }
    });

    // Ressourcen mit Enter hinzuf√ºgen
    newResourceName.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        addResourceBtn.click();
      }
    });

    // Ressourcen Liste rendern
    function renderResourcesList() {
      resourcesList.innerHTML = '';
      currentResources.forEach((resource, index) => {
        const span = document.createElement('span');
        span.className = 'resource-tag flex items-center';
        span.innerHTML = `
          ${resource.name} (${resource.min}-${resource.max})
          <button type="button" class="ml-1 text-red-400 hover:text-red-300 remove-resource" data-index="${index}">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </button>
        `;
        resourcesList.appendChild(span);
      });
      
      // Event Listener f√ºr L√∂schen-Buttons
      document.querySelectorAll('.remove-resource').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.getAttribute('data-index'));
          currentResources.splice(index, 1);
          renderResourcesList();
        });
      });
    }

    // Bild-Upload Event Listener
    productImageFile.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        // Dateigr√∂√üe pr√ºfen (max. 5MB)
        if (file.size > 5 * 1024 * 1024) {
          alert('Die Datei ist zu gro√ü. Maximale Gr√∂√üe: 5MB');
          this.value = '';
          return;
        }
        
        // Vorschau anzeigen
        const reader = new FileReader();
        reader.onload = function(e) {
          imagePreview.src = e.target.result;
          imagePreview.style.display = 'block';
          productImageData.value = e.target.result; // Base64 Daten speichern
        };
        reader.readAsDataURL(file);
      }
    });

    adminLoginBtn.addEventListener('click', () => {
      if (adminPassInput.value === ADMIN_PASSWORD) { 
        adminError.classList.add('hidden-el'); 
        show(document.getElementById('adminContent')); 
        renderAdminTable(); 
        adminPassInput.value = '';
      } else {
        adminError.classList.remove('hidden-el');
        adminPassInput.value = '';
        adminPassInput.focus();
      }
    });

    // Allow login with Enter key
    adminPassInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        adminLoginBtn.click();
      }
    });

    function renderAdminTable() {
      adminTableBody.innerHTML = '';
      
      // Produkte in Admin-Tabelle
      products.forEach(product => {
        const tr = document.createElement('tr');
        tr.className = 'border-t border-amber-800 hover:bg-amber-800/30 transition-colors';
        
        let resourcesText = '';
        if (product.resources && product.resources.length > 0) {
          resourcesText = product.resources.map(r => `${r.name} (${r.min}-${r.max})`).join(', ');
        } else {
          resourcesText = 'Keine Ressourcen';
        }
        
        tr.innerHTML = `
          <td class="p-3">${product.name}</td>
          <td class="p-3">${resourcesText}</td>
          <td class="p-3">
            <div class="flex gap-2">
              <button class="px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-sm rounded-lg btn flex items-center gap-1 edit-product" data-key="${product.key}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                </svg>
                Bearbeiten
              </button>
              <button class="px-3 py-1.5 bg-red-600 hover:bg-red-500 text-sm rounded-lg btn flex items-center gap-1 delete-product" data-key="${product.key}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 000-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
                L√∂schen
              </button>
            </div>
          </td>`;
        adminTableBody.appendChild(tr);
      });
      
      // Event Listener f√ºr Bearbeiten-Buttons
      document.querySelectorAll('.edit-product').forEach(btn => {
        btn.addEventListener('click', function() {
          const key = this.getAttribute('data-key');
          editProduct(key);
        });
      });
      
      // Event Listener f√ºr L√∂schen-Buttons
      document.querySelectorAll('.delete-product').forEach(btn => {
        btn.addEventListener('click', function() {
          const key = this.getAttribute('data-key');
          deleteProduct(key);
        });
      });
      
      totalProducts.innerText = products.length;
    }

    // Admin-Suchfunktion
    document.getElementById('adminSearchInput').addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      
      if (searchTerm === '') {
        renderAdminTable();
        return;
      }
      
      const filteredProducts = products.filter(product => 
        product.name.toLowerCase().includes(searchTerm) ||
        (product.resources && product.resources.some(resource => 
          resource.name.toLowerCase().includes(searchTerm)
        ))
      );
      
      adminTableBody.innerHTML = '';
      
      if (filteredProducts.length === 0) {
        adminTableBody.innerHTML = '<tr><td colspan="3" class="p-4 text-center text-amber-400">Keine Produkte gefunden</td></tr>';
        return;
      }
      
      filteredProducts.forEach(product => {
        const tr = document.createElement('tr');
        tr.className = 'border-t border-amber-800 hover:bg-amber-800/30 transition-colors';
        
        let resourcesText = '';
        if (product.resources && product.resources.length > 0) {
          resourcesText = product.resources.map(r => `${r.name} (${r.min}-${r.max})`).join(', ');
        } else {
          resourcesText = 'Keine Ressourcen';
        }
        
        tr.innerHTML = `
          <td class="p-3">${product.name}</td>
          <td class="p-3">${resourcesText}</td>
          <td class="p-3">
            <div class="flex gap-2">
              <button class="px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-sm rounded-lg btn flex items-center gap-1 edit-product" data-key="${product.key}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                </svg>
                Bearbeiten
              </button>
              <button class="px-3 py-1.5 bg-red-600 hover:bg-red-500 text-sm rounded-lg btn flex items-center gap-1 delete-product" data-key="${product.key}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 000-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
                L√∂schen
              </button>
            </div>
          </td>`;
        adminTableBody.appendChild(tr);
      });
      
      // Event Listener f√ºr Bearbeiten-Buttons
      document.querySelectorAll('.edit-product').forEach(btn => {
        btn.addEventListener('click', function() {
          const key = this.getAttribute('data-key');
          editProduct(key);
        });
      });
      
      // Event Listener f√ºr L√∂schen-Buttons
      document.querySelectorAll('.delete-product').forEach(btn => {
        btn.addEventListener('click', function() {
          const key = this.getAttribute('data-key');
          deleteProduct(key);
        });
      });
    });

    // Produkt bearbeiten
    function editProduct(key) {
      const product = products.find(p => p.key === key);
      if (!product) return;
      
      // Formular mit Produkt-Daten f√ºllen
      document.getElementById('productName').value = product.name;
      productKeyInput.value = key;
      
      // Ressourcen setzen
      currentResources = product.resources ? [...product.resources] : [];
      renderResourcesList();
      
      // Bild-Daten setzen
      if (product.imageData) {
        imagePreview.src = product.imageData;
        imagePreview.style.display = 'block';
        productImageData.value = product.imageData;
      } else {
        imagePreview.style.display = 'none';
        productImageData.value = '';
      }
      
      // Modal-Titel √§ndern
      productModalTitle.textContent = 'Produkt bearbeiten';
      
      // Modal anzeigen
      show(productModal);
    }

    // Modal f√ºr Produkt hinzuf√ºgen
    addProductBtn.addEventListener('click', () => {
      // Formular zur√ºcksetzen
      productForm.reset();
      productKeyInput.value = '';
      imagePreview.style.display = 'none';
      productImageData.value = '';
      currentResources = [];
      renderResourcesList();
      
      // Modal-Titel √§ndern
      productModalTitle.textContent = 'Produkt hinzuf√ºgen';
      
      show(productModal);
    });

    cancelProduct.addEventListener('click', () => {
      hide(productModal);
      productForm.reset();
      imagePreview.style.display = 'none';
      productImageData.value = '';
      currentResources = [];
      renderResourcesList();
    });

    // Modal schlie√üen, wenn au√üerhalb geklickt wird
    productModal.addEventListener('click', (e) => {
      if (e.target === productModal) {
        hide(productModal);
        productForm.reset();
        imagePreview.style.display = 'none';
        productImageData.value = '';
        currentResources = [];
        renderResourcesList();
      }
    });

    productForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const name = document.getElementById('productName').value;
      const imageData = productImageData.value;
      const key = productKeyInput.value;
      
      // Produkt-Objekt erstellen
      const productData = {
        name,
        resources: [...currentResources],
        date: new Date().toISOString(),
        timestamp: Date.now()
      };
      
      // Bild-Daten hinzuf√ºgen, falls vorhanden
      if (imageData) {
        productData.imageData = imageData;
      }
      
      if (key) {
        // Bestehendes Produkt aktualisieren
        const index = products.findIndex(p => p.key === key);
        if (index !== -1) {
          products[index] = { ...products[index], ...productData };
        }
      } else {
        // Neues Produkt erstellen
        productData.key = Date.now().toString();
        products.push(productData);
      }
      
      saveDataToStorage();
      hide(productModal);
      productForm.reset();
      imagePreview.style.display = 'none';
      productImageData.value = '';
      currentResources = [];
      renderResourcesList();
      renderProducts();
      renderAdminTable();
    });

    // L√∂schfunktion
    window.deleteProduct = function(key) { 
      if (confirm('Produkt wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.')) { 
        products = products.filter(p => p.key !== key);
        saveDataToStorage();
        renderProducts();
        renderAdminTable();
      }
    }

    // Initialisierung
    document.addEventListener('DOMContentLoaded', () => {
      loadDataFromStorage();
      renderProducts();
      updateButtonStates('products');
      
      // Sicherstellen, dass alle Modals versteckt sind
      hide(productModal);
    });
  </script>
</body>
</html>

<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Bullet Farm v2 ‚Äî Shop</title>
<!-- Updated: Kategorien-Tab + Shop-Filter + Admin fixes (v2) -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root{--bg:#0f1724;--card:#0b1220;--muted:#9ca3af;--accent:#06b6d4}
body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;background:#071025;color:#e6eef8;margin:0}
.container{max-width:1100px;margin:0 auto;padding:20px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);border-radius:12px;padding:16px}
.shadow-soft{box-shadow:0 8px 30px rgba(2,6,23,0.6)}
.small-muted{color:var(--muted);font-size:0.85rem;margin-top:4px}
.btn{transition:all .12s ease;border-radius:8px;padding:.45rem .8rem;cursor:pointer;background:#111827;color:#e6eef8;border:1px solid rgba(255,255,255,0.03)}
.btn:hover{transform:translateY(-2px)}
.hidden-el{display:none !important}
.product-image{width:100%;height:130px;object-fit:cover;border-radius:8px}
.product-image-admin{width:80px;height:50px;object-fit:cover;border-radius:6px}
#productsGrid .card{max-width:220px;margin:0 auto}
.modal-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(4,6,11,0.6);opacity:0;pointer-events:none;transition:opacity .22s ease;z-index:80}
.modal-overlay.active{opacity:1;pointer-events:all}
.modal-box{width:96%;max-width:980px;background:linear-gradient(180deg,#0b1220,#0f1724);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 20px 60px rgba(2,6,23,0.7);transform:translateY(-8px);transition:transform .22s ease}
.modal-overlay.active .modal-box{transform:translateY(0)}
.tab-btn{padding:8px 12px;border-radius:8px;background:rgba(255,255,255,0.02);cursor:pointer}
.tab-btn.active{background:linear-gradient(90deg,#94a3b8,#06b6d4);color:#041628;font-weight:700}
.table {width:100%;border-collapse:collapse}
.table th,.table td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left;font-size:0.92rem}
.kv{font-size:0.9rem;color:var(--muted)}
.category-item{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:8px;background:rgba(255,255,255,0.02);border-radius:8px;margin-bottom:6px}
.input,textarea,select{background:#071224;border:1px solid rgba(255,255,255,0.04);color:#e6eef8;padding:.5rem;border-radius:8px;width:100%}
.color-input{width:48px;height:36px;padding:0;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:#fff}
.small-btn{padding:.35rem .6rem;border-radius:6px}
.flex-row{display:flex;gap:8px;align-items:center}
.right{margin-left:auto}
</style>
</head>
<body>
<div class="container">
<!-- HEADER -->
<header class="card shadow-soft mb-6 flex items-center justify-between">
<div class="flex items-center gap-4">
<img id="headerLogo" src="https://via.placeholder.com/48" alt="Logo" style="width:48px;height:48px;object-fit:cover;border-radius:8px">
<div>
<h1 id="pageTitle" style="font-size:1.4rem;font-weight:700;color:#22c55e;margin:0">Bullet Farm v2</h1>
<div class="small-muted">Shop</div>
</div>
</div>
<div class="flex items-center gap-2">
<button id="btnShop" class="btn">Shop</button>
<button id="btnCart" class="btn">Warenkorb</button>
<button id="openSettingsBtn" class="btn">‚öôÔ∏è</button>
</div>
</header>
<!-- MAIN: SHOP -->
<main id="mainContent">
<section id="shopView" class="card mb-6">
<div class="flex items-center justify-between mb-4">
<div style="display:flex;gap:10px;align-items:center">
<h2 style="font-weight:700;color:#22c55e;margin:0">üõí Produkte</h2>
<div class="kv">Filter:</div>
<select id="shopCategoryFilter" class="input" style="width:200px">
<option value="">‚Äî Alle Kategorien ‚Äî</option>
</select>
</div>
<div class="kv">Produkte anzeigen</div>
</div>
<div id="productsGrid" class="grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px"></div>
</section>
<!-- CART VIEW -->
<section id="cartView" class="card mb-6 hidden-el">
<div class="flex items-center justify-between mb-4">
<h2 style="font-weight:700;color:#22c55e">üõçÔ∏è Warenkorb</h2>
<div class="kv">Ressourcen & Anzahl</div>
</div>
<table class="table" id="cartTable">
<thead><tr><th>Produkt</th><th>Ressourcen</th><th style="text-align:right">Anzahl</th></tr></thead>
<tbody></tbody>
</table>
<div style="margin-top:12px;font-weight:700" id="cartSummary">Gesamt Ressourcen: keine</div>
</section>
</main>
</div>
<!-- SETTINGS MODAL (Produkte / Kategorien / Allgemein) -->
<div id="settingsModal" class="modal-overlay hidden-el" aria-hidden="true">
<div class="modal-box">
<div class="flex items-start justify-between mb-4">
<div>
<h3 style="font-size:1.15rem;font-weight:700;color:#94a3b8;margin:0">‚öôÔ∏è Einstellungen</h3>
<div class="kv">Passwortgesch√ºtzt ‚Äî Admin Funktionen</div>
</div>
<div class="flex gap-2 items-center">
<button id="settingsCloseBtn" class="btn">‚úñ</button>
</div>
</div>
<!-- LOGIN -->
<div id="settingsLoginArea">
<label class="kv mb-2">Admin Passwort</label>
<div class="flex items-center gap-2 mb-3">
<input id="settingsPassword" type="password" class="input" placeholder="Passwort (admin123)"/>
<button id="settingsUnlockBtn" class="btn">Einloggen</button>
</div>
<div id="settingsLoginError" class="kv" style="color:#ff7b7b;display:none">‚ùå Falsches Passwort</div>
</div>
<!-- EDITOR -->
<div id="settingsEditor" class="hidden-el">
<div class="mb-4">
<div class="flex gap-2">
<button class="tab-btn active" data-tab="products">Produkte</button>
<button class="tab-btn" data-tab="categories">Kategorien</button>
<button class="tab-btn" data-tab="general">Allgemein</button>
</div>
</div>
<!-- PRODUCTS TAB -->
<div id="tabProducts" class="tab-panel">
<div class="flex items-center justify-between mb-3">
<h4 style="font-weight:700">Produkte verwalten</h4>
<div class="flex gap-2">
<button id="btnNewProduct" class="btn">Neues Produkt</button>
<button id="btnReloadProducts" class="btn">Neu laden</button>
</div>
</div>
<!-- Produkt-Form (inkl. Ressourcen & Kategorie) -->
<div id="productFormCard" class="card mb-3 hidden-el">
<form id="productForm">
<input id="prodId" type="hidden"/>
<div style="display:grid;grid-template-columns:1fr 120px;gap:10px;margin-bottom:10px">
<div>
<input id="prodName" class="input" placeholder="Name" required />
<input id="prodImg" class="input" placeholder="Bild-URL" style="margin-top:8px"/>
</div>
<div style="display:flex;flex-direction:column;gap:8px">
<label class="kv">Vorschau</label>
<img id="prodPreview" src="https://via.placeholder.com/150x100" alt="Vorschau" style="width:100%;height:80px;object-fit:cover;border-radius:6px;border:1px solid rgba(255,255,255,0.03)">
</div>
</div>
<textarea id="prodDesc" class="input" rows="2" placeholder="Beschreibung (optional)" style="margin-bottom:8px"></textarea>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:8px">
<select id="prodCategorySelect" class="input">
<option value="">‚Äî Keine Kategorie ‚Äî</option>
</select>
<div style="display:flex;gap:8px;align-items:center">
<label class="kv">Name-Farbe</label>
<input id="colorNameInput" type="color" class="color-input" value="#22c55e">
<label class="kv" style="margin-left:8px">Anzahl-Farbe</label>
<input id="colorQuantityInput" type="color" class="color-input" value="#3b82f6">
</div>
</div>
<!-- Ressourcen-Tabelle -->
<div id="resourceTableContainer" style="margin-bottom:8px">
<h5 style="margin:0 0 8px 0;font-weight:700">Ressourcen (Name:Anzahl:Farbe)</h5>
<table class="table" id="resourceTable">
<thead>
<tr><th>Ressource</th><th style="width:120px;text-align:right">Anzahl</th><th style="width:120px">Farbe</th><th style="width:60px">Aktion</th></tr>
</thead>
<tbody style="background:transparent"></tbody>
</table>
<div style="margin-top:8px">
<button id="addResourceBtn" type="button" class="btn">Ressource hinzuf√ºgen</button>
</div>
</div>
<div style="display:flex;gap:8px">
<button type="submit" class="btn" style="background:#10b981">Speichern</button>
<button id="cancelProductBtn" type="button" class="btn" style="background:#ef4444">Abbrechen</button>
</div>
</form>
</div>
<!-- Product list (Admin) -->
<div class="card" style="max-height:46vh;overflow:auto">
<table class="table" style="width:100%">
<thead><tr><th>Vorschau</th><th>Name</th><th>Kategorie</th><th>Ressourcen</th><th style="width:140px">Aktionen</th></tr></thead>
<tbody id="productsTableBody"></tbody>
</table>
</div>
</div>
<!-- CATEGORIES TAB -->
<div id="tabCategories" class="tab-panel hidden-el">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
<h4 style="font-weight:700">Kategorien verwalten</h4>
<div style="display:flex;gap:8px;width:360px">
<input id="newCategoryInput" class="input" placeholder="Neue Kategorie" />
<button id="addCategoryBtn" class="btn">Hinzuf√ºgen</button>
</div>
</div>
<div id="categoriesList" class="card" style="max-height:36vh;overflow:auto;padding:12px">
<!-- Liste wird dynamisch gef√ºllt -->
</div>
</div>
<!-- GENERAL TAB -->
<div id="tabGeneral" class="tab-panel hidden-el">
<h4 style="font-weight:700;margin-bottom:8px">Allgemein</h4>
<label class="kv mb-2">Titel</label>
<input id="settingTitle" class="input" placeholder="Seiten-Titel"/>
<label class="kv mb-2" style="margin-top:8px">Header Bild URL (48x48 empfohlen)</label>
<input id="settingHeaderImage" class="input" placeholder="Bild-URL"/>
<div style="display:flex;gap:8px;margin-top:10px">
<button id="saveGeneralBtn" class="btn" style="background:#10b981">Speichern</button>
<button id="resetGeneralBtn" class="btn" style="background:#ef4444">Zur√ºcksetzen</button>
</div>
</div>
</div>
<!-- end editor -->
</div>
</div>
<script type="module">
/* ---------- Firebase imports ---------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getDatabase, ref, push, onValue, remove, update, get } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
/* ---------- Config (deine) ---------- */
const firebaseConfig = { apiKey:"AIzaSyCw4nadHCIRcouTJJoQ3ElToiVVFr5Rufo", authDomain:"khusland-b7d13.firebaseapp.com", databaseURL:"https://khusland-b7d13-default-rtdb.firebaseio.com", projectId:"khusland-b7d13", storageBucket:"khusland-b7d13.firebasestorage.app", messagingSenderId:"69573193613", appId:"1:69573193613:web:86c4d839281b1e343cd7c4", measurementId:"G-JSCWR4207G" };
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const productsRef = ref(db, 'products');
const settingsRef = ref(db, 'settings');
const categoriesRef = ref(db, 'categories');
/* ---------- Globals & elements ---------- */
const ADMIN_PASSWORD = 'admin123';
const openSettingsBtn = document.getElementById('openSettingsBtn');
const settingsModal = document.getElementById('settingsModal');
const settingsCloseBtn = document.getElementById('settingsCloseBtn');
const settingsPassword = document.getElementById('settingsPassword');
const settingsUnlockBtn = document.getElementById('settingsUnlockBtn');
const settingsLoginError = document.getElementById('settingsLoginError');
const settingsLoginArea = document.getElementById('settingsLoginArea');
const settingsEditor = document.getElementById('settingsEditor');
const tabBtns = document.querySelectorAll('.tab-btn');
const tabPanels = document.querySelectorAll('.tab-panel');
const btnNewProduct = document.getElementById('btnNewProduct');
const productFormCard = document.getElementById('productFormCard');
const productForm = document.getElementById('productForm');
const cancelProductBtn = document.getElementById('cancelProductBtn');
const prodId = document.getElementById('prodId');
const prodName = document.getElementById('prodName');
const prodImg = document.getElementById('prodImg');
const prodPreview = document.getElementById('prodPreview');
const prodDesc = document.getElementById('prodDesc');
const prodCategorySelect = document.getElementById('prodCategorySelect');
const colorNameInput = document.getElementById('colorNameInput');
const colorQuantityInput = document.getElementById('colorQuantityInput');
const addResourceBtn = document.getElementById('addResourceBtn');
const resourceTable = document.querySelector('#resourceTable tbody');
const productsTableBody = document.getElementById('productsTableBody');
const btnReloadProducts = document.getElementById('btnReloadProducts');
const settingTitle = document.getElementById('settingTitle');
const settingHeaderImage = document.getElementById('settingHeaderImage');
const saveGeneralBtn = document.getElementById('saveGeneralBtn');
const resetGeneralBtn = document.getElementById('resetGeneralBtn');
const pageTitle = document.getElementById('pageTitle');
const headerLogo = document.getElementById('headerLogo');
const productsGrid = document.getElementById('productsGrid');
const shopView = document.getElementById('shopView');
const cartView = document.getElementById('cartView');
const btnShop = document.getElementById('btnShop');
const btnCart = document.getElementById('btnCart');
const cartTableBody = document.querySelector('#cartTable tbody');
const cartSummary = document.getElementById('cartSummary');
const shopCategoryFilter = document.getElementById('shopCategoryFilter');
const newCategoryInput = document.getElementById('newCategoryInput');
const addCategoryBtn = document.getElementById('addCategoryBtn');
const categoriesList = document.getElementById('categoriesList');
let products = [];
let settings = { title: 'Bullet Farm', headerImage: 'https://via.placeholder.com/48', categories: [] };
let categories = [];
let cart = [];

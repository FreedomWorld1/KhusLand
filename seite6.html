<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>KhusLand Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #7e22ce;
      --primary-light: #a855f7;
      --secondary: #ec4899;
      --dark: #0f172a;
      --dark-light: #1e293b;
      --text: #f8fafc;
      --text-muted: #94a3b8;
    }
    
    body { 
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, var(--dark) 0%, var(--dark-light) 100%);
      min-height: 100vh;
      color: var(--text);
    }
    
    .card { 
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%); 
      border: 1px solid rgba(168, 85, 247, 0.2); 
      border-radius: 12px; 
      backdrop-filter: blur(10px);
    }
    
    .shadow-soft { 
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5), 
                  0 4px 8px rgba(0, 0, 0, 0.3),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1); 
    }
    
    .small-muted { 
      color: var(--text-muted); 
      font-size: 0.75rem; 
    }
    
    .btn { 
      transition: all 0.2s ease; 
      font-size: 0.8rem; 
      font-weight: 500;
      border: none;
      cursor: pointer;
    }
    
    .btn:hover { 
      transform: translateY(-1px); 
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .hidden { 
      display: none !important; 
    }
    
    input, textarea { 
      transition: all 0.2s ease; 
      font-size: 0.85rem; 
      background: rgba(30, 41, 59, 0.5);
      border: 1px solid rgba(100, 116, 139, 0.5);
      border-radius: 8px;
      color: var(--text);
      padding: 0.5rem 0.75rem;
      width: 100%;
    }
    
    input:focus, textarea:focus { 
      outline: none; 
      border-color: var(--primary-light); 
      box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.3); 
    }
    
    input::placeholder, textarea::placeholder {
      color: var(--text-muted);
    }
    
    .active-link { 
      background-color: var(--primary) !important; 
      color: #fff !important; 
      font-weight: 600; 
    }
    
    .gradient-text {
      background: linear-gradient(90deg, var(--primary-light) 0%, var(--secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .glass-effect {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(168, 85, 247, 0.1);
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .pulse-glow {
      animation: pulseGlow 2s infinite;
    }
    
    @keyframes pulseGlow {
      0% { box-shadow: 0 0 5px rgba(168, 85, 247, 0.5); }
      50% { box-shadow: 0 0 15px rgba(168, 85, 247, 0.8); }
      100% { box-shadow: 0 0 5px rgba(168, 85, 247, 0.5); }
    }
    
    .scrollbar-custom::-webkit-scrollbar {
      width: 4px;
    }
    
    .scrollbar-custom::-webkit-scrollbar-track {
      background: rgba(30, 41, 59, 0.5);
      border-radius: 8px;
    }
    
    .scrollbar-custom::-webkit-scrollbar-thumb {
      background: var(--primary-light);
      border-radius: 8px;
    }
    
    .hamburger-container {
      position: relative;
      z-index: 1000;
    }
    
    .hamburger-menu {
      z-index: 1001;
    }
    
    .notification {
      position: fixed;
      top: 15px;
      right: 15px;
      z-index: 10000;
      padding: 10px 16px;
      border-radius: 6px;
      color: white;
      font-weight: 500;
      font-size: 0.8rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transform: translateX(150%);
      transition: transform 0.3s ease;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.success {
      background-color: #10b981;
    }
    
    .notification.error {
      background-color: #ef4444;
    }
    
    .notification.info {
      background-color: #3b82f6;
    }
    
    .notification.warning {
      background-color: #f59e0b;
    }
    
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .text-item {
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .text-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .color-preview {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      display: inline-block;
      margin-right: 8px;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    /* Neue Styles f√ºr verbesserte UI */
    .section-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .empty-state {
      text-align: center;
      padding: 2rem;
      color: var(--text-muted);
    }
    
    .empty-state i {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      opacity: 0.5;
    }
    
    .text-content-preview {
      white-space: pre-wrap;
      max-height: 100px;
      overflow: hidden;
      position: relative;
    }
    
    .text-content-preview::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 30px;
      background: linear-gradient(transparent, rgba(30, 41, 59, 0.8));
    }
    
    .webhook-status {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.7rem;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      margin-top: 0.25rem;
    }
    
    .webhook-valid {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
    }
    
    .webhook-invalid {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }
    
    .webhook-empty {
      background: rgba(156, 163, 175, 0.2);
      color: #9ca3af;
    }
    
    .action-buttons {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }
    
    .action-buttons button {
      flex: 1;
      padding: 0.4rem 0.5rem;
      font-size: 0.7rem;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
    }
    
    .search-container {
      margin-bottom: 1rem;
      position: relative;
    }
    
    .search-container i {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
    }
    
    .search-container input {
      padding-left: 2.25rem;
    }
    
    .character-count {
      text-align: right;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }
    
    .character-count.warning {
      color: #f59e0b;
    }
    
    .character-count.error {
      color: #ef4444;
    }
    
    .text-stats {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.5rem;
    }
    
    @media (max-width: 640px) {
      .header-content {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
      }
      
      .header-actions {
        width: 100%;
        justify-content: space-between;
      }
      
      .text-grid {
        grid-template-columns: 1fr !important;
      }
    }
  </style>
</head>
<body class="text-gray-100 antialiased min-h-screen">
  
  <!-- Notification System -->
  <div id="notification" class="notification hidden"></div>
  
  <!-- LOGIN SCREEN -->
  <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
    <div class="card p-6 shadow-soft max-w-md w-full text-center">
      <div class="w-16 h-16 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center mx-auto mb-4">
        <span class="text-white text-xl">üí¨</span>
      </div>
      <h1 class="text-2xl font-bold gradient-text mb-2">KhusLand Management</h1>
      <p class="text-gray-400 text-sm mb-4">Bitte mit Discord einloggen um fortzufahren</p>
      
      <button id="discordLogin" class="w-full py-2.5 bg-[#5865F2] hover:bg-[#4752c4] rounded-lg btn font-medium flex items-center justify-center gap-2 transition-all duration-200">
        <i class="fab fa-discord text-lg"></i>
        Mit Discord anmelden
      </button>
      
      <div id="loginError" class="mt-3 p-2 bg-red-900/20 border border-red-700 rounded-lg text-red-400 text-sm hidden">
        <p id="errorMessage">Zugriff verweigert. Du bist nicht autorisiert.</p>
      </div>
    </div>
  </div>

  <!-- MAIN CONTENT (Versteckt bis Login) -->
  <div id="mainContent" class="hidden">
    <div class="max-w-6xl mx-auto p-3 md:p-4">

      <!-- HEADER -->
      <header class="glass-effect rounded-xl shadow-soft mb-4 p-3 md:p-4 relative z-10">
        <div class="header-content flex justify-between items-center">
          <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center">
              <span class="text-white font-bold text-sm">üí¨</span>
            </div>
            <div>
              <h1 class="text-xl md:text-2xl font-bold gradient-text tracking-tight">Text Manager</h1>
              <p id="userInfo" class="text-xs text-gray-400">
                Eingeloggt als: <span id="username">Unbekannt</span>
              </p>
            </div>
          </div>
          <div class="header-actions flex items-center gap-1">
            <button id="btnMain" class="btn px-2.5 py-1.5 bg-purple-600 hover:bg-purple-500 rounded-lg shadow-sm pulse-glow">
              <i class="fas fa-home text-xs mr-1"></i> Hauptbereich
            </button>
            <button id="btnSettings" class="btn px-2.5 py-1.5 bg-blue-600 hover:bg-blue-500 rounded-lg shadow-sm">
              <i class="fas fa-cog text-xs mr-1"></i> Einstellungen
            </button>
            <div class="hamburger-container">
              <button id="hamburgerBtn" class="p-1.5 flex flex-col justify-between h-5 w-7 focus:outline-none ml-1 rounded-md bg-gray-800 hover:bg-gray-700">
                <span class="block h-0.5 bg-gray-100 rounded-full"></span>
                <span class="block h-0.5 bg-gray-100 rounded-full"></span>
                <span class="block h-0.5 bg-gray-100 rounded-full"></span>
              </button>
              <div id="hamburgerMenu" class="hamburger-menu hidden absolute right-0 mt-1.5 w-40 glass-effect border border-gray-700 rounded-lg shadow-lg overflow-hidden">
                <a href="index.html" class="block px-3 py-2 hover:bg-gray-700 transition-colors text-sm">
                  <i class="fas fa-cannabis mr-2 text-xs"></i> Weed
                </a>
                <a href="seite2.html" class="block px-3 py-2 hover:bg-gray-700 transition-colors text-sm">
                  <i class="fas fa-pills mr-2 text-xs"></i> Kokain
                </a>
                <a href="https://khusland.github.io/KhusLand2/" class="block px-3 py-2 hover:bg-gray-700 transition-colors text-sm">
                  <i class="fas fa-calculator mr-2 text-xs"></i> 30% Rechner
                </a>
                <a href="seite4.html" class="block px-3 py-2 hover:bg-gray-700 transition-colors text-sm">
                  <i class="fas fa-industry mr-2 text-xs"></i> Herstellung
                </a>
                <a href="seite3.html" class="block px-3 py-2 hover:bg-gray-700 transition-colors text-sm">
                  <i class="fas fa-recycle mr-2 text-xs"></i> Materialrecycler
                </a>
                <a href="seite5.html" class="block px-3 py-2 hover:bg-gray-700 transition-colors text-sm">
                  <i class="fas fa-route mr-2 text-xs"></i> Routen
                </a>
              </div>
            </div>
            <button id="logoutBtn" class="btn px-2.5 py-1.5 bg-red-600 hover:bg-red-500 rounded-lg shadow-sm ml-1">
              <i class="fas fa-sign-out-alt text-xs mr-1"></i> Logout
            </button>
          </div>
        </div>
      </header>

      <div id="mainContainer" class="space-y-4 relative z-0">

        <!-- HAUPTBEREICH -->
        <div id="mainArea" class="card p-4 shadow-soft fade-in">
          <div class="section-title">
            <i class="fas fa-home text-purple-400"></i>
            <h2 class="text-lg font-semibold text-purple-400">Hauptbereich</h2>
          </div>
          
          <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" id="searchTexts" placeholder="Texte durchsuchen...">
          </div>
          
          <div class="mb-4 p-3 bg-gray-800/30 rounded-lg border border-gray-700">
            <p class="text-sm text-gray-300 mb-2">W√§hle einen Text aus und klicke darauf, um ihn zu verwenden:</p>
            <div id="textList" class="text-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
              <!-- Text-Elemente werden hier dynamisch geladen -->
            </div>
          </div>
          
          <!-- Text verwenden und bearbeiten Bereich -->
          <div id="textUseSection" class="hidden p-4 bg-gray-800/30 rounded-lg border border-gray-700">
            <h3 class="text-base font-medium mb-2 text-blue-400 flex items-center gap-1">
              <i class="fas fa-edit text-sm"></i>
              Text verwenden und bearbeiten
            </h3>
            <div class="mb-3">
              <label for="editTextContent" class="block text-xs font-medium text-gray-300 mb-1">
                <i class="fas fa-align-left mr-1 text-xs"></i> Text bearbeiten (nur f√ºr dich sichtbar)
              </label>
              <textarea id="editTextContent" rows="6" class="w-full p-2 rounded-lg bg-gray-800/50 border border-gray-700 focus:border-purple-500 text-sm"></textarea>
              <div id="editCharCount" class="character-count">0 Zeichen</div>
            </div>
            <div class="flex gap-2">
              <button id="sendTextBtn" class="flex-1 px-3 py-2 bg-green-600 hover:bg-green-500 rounded-lg btn font-medium flex items-center justify-center gap-1">
                <i class="fas fa-paper-plane text-xs"></i>
                An Discord senden
              </button>
              <button id="copyTextBtn" class="px-3 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg btn font-medium flex items-center justify-center gap-1">
                <i class="fas fa-copy text-xs"></i>
                Kopieren
              </button>
              <button id="cancelUseBtn" class="px-3 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg btn font-medium flex items-center justify-center gap-1">
                <i class="fas fa-times text-xs"></i>
                Abbrechen
              </button>
            </div>
          </div>
        </div>

        <!-- EINSTELLUNGEN -->
        <div id="settingsArea" class="card p-4 shadow-soft hidden fade-in">
          <div class="section-title">
            <i class="fas fa-cog text-blue-400"></i>
            <h2 class="text-lg font-semibold text-blue-400">Einstellungen</h2>
          </div>
          
          <div id="adminLoginSection" class="mb-4 p-4 bg-gray-800/30 rounded-lg border border-gray-700">
            <div class="mb-3">
              <label for="adminPass" class="block text-xs font-medium text-gray-300 mb-1">
                <i class="fas fa-key mr-1 text-xs"></i> Admin-Passwort
              </label>
              <input id="adminPass" type="password" placeholder="Passwort eingeben" class="w-full p-2 rounded-lg bg-gray-800/50 border border-gray-700 focus:border-blue-500 text-sm"/>
            </div>
            <button id="adminLoginBtn" class="w-full py-2 bg-blue-600 hover:bg-blue-500 rounded-lg btn font-medium flex items-center justify-center gap-1">
              <i class="fas fa-sign-in-alt text-xs"></i>
              Einloggen
            </button>
            <span id="adminError" class="text-red-400 mt-2 block hidden text-center text-xs py-1.5 bg-red-900/20 rounded-lg">
              <i class="fas fa-exclamation-triangle mr-1 text-xs"></i> Falsches Passwort
            </span>
          </div>
          
          <div id="adminContent" class="hidden">
            <!-- Text hinzuf√ºgen -->
            <div class="mb-4 p-4 bg-gray-800/30 rounded-lg border border-gray-700">
              <h3 class="text-base font-medium mb-2 text-green-400 flex items-center gap-1">
                <i class="fas fa-plus text-sm"></i>
                Text hinzuf√ºgen
              </h3>
              <div class="mb-3">
                <label for="newTextTitle" class="block text-xs font-medium text-gray-300 mb-1">
                  <i class="fas fa-heading mr-1 text-xs"></i> Titel
                </label>
                <input id="newTextTitle" type="text" placeholder="Titel des Texts" class="w-full p-2 rounded-lg bg-gray-800/50 border border-gray-700 focus:border-purple-500 text-sm"/>
              </div>
              <div class="mb-3">
                <label for="newTextContent" class="block text-xs font-medium text-gray-300 mb-1">
                  <i class="fas fa-align-left mr-1 text-xs"></i> Inhalt
                </label>
                <textarea id="newTextContent" rows="4" placeholder="Inhalt des Texts" class="w-full p-2 rounded-lg bg-gray-800/50 border border-gray-700 focus:border-purple-500 text-sm"></textarea>
                <div id="newCharCount" class="character-count">0 Zeichen</div>
              </div>
              <div class="mb-3">
                <label for="newTextWebhook" class="block text-xs font-medium text-gray-300 mb-1">
                  <i class="fas fa-link mr-1 text-xs"></i> Webhook URL
                </label>
                <input id="newTextWebhook" type="text" placeholder="Discord Webhook URL" class="w-full p-2 rounded-lg bg-gray-800/50 border border-gray-700 focus:border-purple-500 text-sm"/>
              </div>
              <div class="mb-3">
                <label for="newTextColor" class="block text-xs font-medium text-gray-300 mb-1">
                  <i class="fas fa-palette mr-1 text-xs"></i> Farbe
                </label>
                <div class="flex items-center gap-2">
                  <input id="newTextColor" type="color" value="#a855f7" class="w-10 h-10 rounded-lg cursor-pointer">
                  <span id="newTextColorValue" class="text-xs text-gray-300">#a855f7</span>
                </div>
              </div>
              <button id="addTextBtn" class="w-full py-2 bg-green-600 hover:bg-green-500 rounded-lg btn font-medium flex items-center justify-center gap-1">
                <i class="fas fa-plus text-xs"></i>
                Text hinzuf√ºgen
              </button>
            </div>
            
            <!-- Text bearbeiten/l√∂schen -->
            <div class="p-4 bg-gray-800/30 rounded-lg border border-gray-700">
              <h3 class="text-base font-medium mb-2 text-yellow-400 flex items-center gap-1">
                <i class="fas fa-edit text-sm"></i>
                Texte verwalten
              </h3>
              <div id="textManagementList" class="space-y-3">
                <!-- Verwaltete Texte werden hier geladen -->
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // Discord OAuth Konfiguration - EINFACHES SYSTEM
    const DISCORD_CLIENT_ID = '1432942180770644079';
    const DISCORD_REDIRECT_URI = window.location.origin + window.location.pathname;

    // Autorisierte Discord IDs
    const AUTHORIZED_USER_IDS = [
      '917426398120005653', // Rey Ehrlich
      '1387439512438964304' // Philipp Yane
    ];

    // DOM Elemente
    const loginScreen = document.getElementById('loginScreen');
    const mainContent = document.getElementById('mainContent');
    const discordLoginBtn = document.getElementById('discordLogin');
    const loginError = document.getElementById('loginError');
    const errorMessage = document.getElementById('errorMessage');
    const logoutBtn = document.getElementById('logoutBtn');
    const usernameElement = document.getElementById('username');
    const notification = document.getElementById('notification');
    const btnMain = document.getElementById('btnMain');
    const btnSettings = document.getElementById('btnSettings');
    const mainArea = document.getElementById('mainArea');
    const settingsArea = document.getElementById('settingsArea');
    const textList = document.getElementById('textList');
    const textUseSection = document.getElementById('textUseSection');
    const sendTextBtn = document.getElementById('sendTextBtn');
    const copyTextBtn = document.getElementById('copyTextBtn');
    const cancelUseBtn = document.getElementById('cancelUseBtn');
    const editTextContent = document.getElementById('editTextContent');
    const editCharCount = document.getElementById('editCharCount');
    const adminLoginBtn = document.getElementById('adminLoginBtn');
    const adminPassInput = document.getElementById('adminPass');
    const adminError = document.getElementById('adminError');
    const adminContent = document.getElementById('adminContent');
    const addTextBtn = document.getElementById('addTextBtn');
    const newTextTitle = document.getElementById('newTextTitle');
    const newTextContent = document.getElementById('newTextContent');
    const newTextWebhook = document.getElementById('newTextWebhook');
    const newTextColor = document.getElementById('newTextColor');
    const newTextColorValue = document.getElementById('newTextColorValue');
    const newCharCount = document.getElementById('newCharCount');
    const textManagementList = document.getElementById('textManagementList');
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const hamburgerMenu = document.getElementById('hamburgerMenu');
    const searchTexts = document.getElementById('searchTexts');

    // Text-Daten (lokale Speicherung)
    let texts = JSON.parse(localStorage.getItem('text_manager_texts')) || [
      { 
        id: 1, 
        title: "Blacklist", 
        content: "**User** <@>\n**Blood Out von** <@>\nBlacklist-Grund\nVerr√§ter", 
        webhook: "",
        color: "#a855f7",
        createdAt: new Date().toISOString(),
        lastUsed: null
      }
    ];

    // Aktuell ausgew√§hlter Text
    let selectedText = null;
    let originalContent = "";
    let filteredTexts = [...texts];

    // Notification System
    function showNotification(message, type = 'info', duration = 4000) {
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.remove('hidden');
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          notification.classList.add('hidden');
        }, 300);
      }, duration);
    }

    // Texte speichern
    function saveTexts() {
      localStorage.setItem('text_manager_texts', JSON.stringify(texts));
    }

    // EINFACHES DISCORD LOGIN SYSTEM
    function startDiscordOAuth() {
      // Simuliere Discord OAuth Flow
      showNotification('Discord Login wird simuliert...', 'info');
      
      // Simuliere eine Verz√∂gerung f√ºr den Login-Prozess
      setTimeout(() => {
        // Simulierte Benutzerdaten
        const testUsers = [
          { id: '917426398120005653', username: 'Rey Ehrlich', avatar: null },
          { id: '1387439512438964304', username: 'Philipp Yane', avatar: null }
        ];
        
        // W√§hle einen zuf√§lligen autorisierten Benutzer
        const randomUser = testUsers[Math.floor(Math.random() * testUsers.length)];
        
        if (AUTHORIZED_USER_IDS.includes(randomUser.id)) {
          localStorage.setItem('discord_user', JSON.stringify(randomUser));
          localStorage.setItem('discord_access_token', 'simulated_token_' + Date.now());
          showMainContent();
          showNotification(`Eingeloggt als ${randomUser.username}`, 'success');
        } else {
          showError('Zugriff verweigert. Deine Discord-ID ist nicht autorisiert.');
        }
      }, 1500);
    }

    function showError(message) {
      errorMessage.textContent = message;
      loginError.classList.remove('hidden');
    }

    function showMainContent() {
      loginScreen.classList.add('hidden');
      mainContent.classList.remove('hidden');
      
      const user = JSON.parse(localStorage.getItem('discord_user'));
      if (user) {
        usernameElement.textContent = user.username;
      }
      
      // Text-Liste rendern
      renderTextList();
      
      // Bereiche zur√ºcksetzen
      showMainArea();
    }

    function logout() {
      localStorage.removeItem('discord_user');
      localStorage.removeItem('discord_access_token');
      
      mainContent.classList.add('hidden');
      loginScreen.classList.remove('hidden');
      loginError.classList.add('hidden');
      
      showNotification('Ausgeloggt', 'info');
    }

    function checkExistingLogin() {
      const user = localStorage.getItem('discord_user');
      const token = localStorage.getItem('discord_access_token');
      
      if (user && token) {
        const userData = JSON.parse(user);
        if (AUTHORIZED_USER_IDS.includes(userData.id)) {
          showMainContent();
        } else {
          logout();
          showError('Deine Discord-ID ist nicht autorisiert.');
        }
      } else {
        localStorage.removeItem('discord_user');
        localStorage.removeItem('discord_access_token');
      }
    }

    // Event Listeners
    discordLoginBtn.addEventListener('click', startDiscordOAuth);
    logoutBtn.addEventListener('click', logout);

    // Navigation
    btnMain.addEventListener('click', showMainArea);
    btnSettings.addEventListener('click', showSettingsArea);

    function showMainArea() {
      mainArea.classList.remove('hidden');
      settingsArea.classList.add('hidden');
      btnMain.classList.add('active-link');
      btnSettings.classList.remove('active-link');
    }

    function showSettingsArea() {
      mainArea.classList.add('hidden');
      settingsArea.classList.remove('hidden');
      btnMain.classList.remove('active-link');
      btnSettings.classList.add('active-link');
    }

    // Hamburger Menu
    hamburgerBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      hamburgerMenu.classList.toggle('hidden');
    });

    document.addEventListener('click', (e) => {
      if (!hamburgerMenu.contains(e.target) && !hamburgerBtn.contains(e.target)) {
        hamburgerMenu.classList.add('hidden');
      }
    });

    // Text-Liste rendern
    function renderTextList() {
      textList.innerHTML = '';
      
      if (filteredTexts.length === 0) {
        textList.innerHTML = `
          <div class="empty-state col-span-full">
            <i class="fas fa-file-alt"></i>
            <p>Keine Texte gefunden.</p>
            ${searchTexts.value ? '<p class="text-xs mt-2">Versuche einen anderen Suchbegriff.</p>' : ''}
          </div>
        `;
        return;
      }
      
      filteredTexts.forEach(text => {
        const textElement = document.createElement('div');
        textElement.className = 'text-item p-3 rounded-lg bg-gray-800/50 border border-gray-700 hover:border-purple-500/30';
        
        // Webhook-Status
        let webhookStatus = 'webhook-empty';
        let webhookText = 'Kein Webhook';
        
        if (text.webhook) {
          if (text.webhook.startsWith('https://discord.com/api/webhooks/')) {
            webhookStatus = 'webhook-valid';
            webhookText = 'Webhook g√ºltig';
          } else {
            webhookStatus = 'webhook-invalid';
            webhookText = 'Webhook ung√ºltig';
          }
        }
        
        textElement.innerHTML = `
          <div class="flex items-center justify-between mb-1">
            <div class="flex items-center">
              <span class="color-preview" style="background-color: ${text.color}"></span>
              <h3 class="font-semibold text-sm text-white">${text.title}</h3>
            </div>
            <span class="webhook-status ${webhookStatus}">
              <i class="fas ${webhookStatus === 'webhook-valid' ? 'fa-check' : webhookStatus === 'webhook-invalid' ? 'fa-exclamation-triangle' : 'fa-minus'} text-xs"></i>
              ${webhookText}
            </span>
          </div>
          <div class="text-content-preview text-xs text-gray-300">${text.content}</div>
          <div class="text-stats">
            <span>${text.content.length} Zeichen</span>
            <span>${text.lastUsed ? new Date(text.lastUsed).toLocaleDateString('de-DE') : 'Noch nie'}</span>
          </div>
          <div class="action-buttons">
            <button class="use-text-btn bg-green-600 hover:bg-green-500" data-id="${text.id}">
              <i class="fas fa-paper-plane text-xs"></i> Senden
            </button>
            <button class="copy-text-btn bg-blue-600 hover:bg-blue-500" data-id="${text.id}">
              <i class="fas fa-copy text-xs"></i> Kopieren
            </button>
          </div>
        `;
        
        textList.appendChild(textElement);
      });
      
      // Event-Listener f√ºr Verwenden-Buttons
      document.querySelectorAll('.use-text-btn').forEach(button => {
        button.addEventListener('click', (e) => {
          const id = parseInt(e.target.closest('button').getAttribute('data-id'));
          useText(id);
        });
      });
      
      // Event-Listener f√ºr Kopieren-Buttons
      document.querySelectorAll('.copy-text-btn').forEach(button => {
        button.addEventListener('click', (e) => {
          const id = parseInt(e.target.closest('button').getAttribute('data-id'));
          copyText(id);
        });
      });
    }

    // Text verwenden
    function useText(id) {
      selectedText = texts.find(t => t.id === id);
      if (!selectedText) return;
      
      // Originalen Textinhalt speichern und in Textarea laden
      originalContent = selectedText.content;
      editTextContent.value = selectedText.content;
      updateCharCount(editTextContent, editCharCount);
      
      // Verwenden-Bereich anzeigen
      textUseSection.classList.remove('hidden');
      showNotification(`Text "${selectedText.title}" ausgew√§hlt - Du kannst ihn jetzt bearbeiten`, 'info');
    }

    // Text kopieren
    function copyText(id) {
      const text = texts.find(t => t.id === id);
      if (!text) return;
      
      navigator.clipboard.writeText(text.content)
        .then(() => {
          showNotification(`Text "${text.title}" in die Zwischenablage kopiert`, 'success');
          
          // Aktualisiere lastUsed Zeitstempel
          text.lastUsed = new Date().toISOString();
          saveTexts();
          renderTextList();
        })
        .catch(err => {
          console.error('Fehler beim Kopieren: ', err);
          showNotification('Fehler beim Kopieren des Texts', 'error');
        });
    }

    // Text an Discord senden
    sendTextBtn.addEventListener('click', async () => {
      if (!selectedText) {
        showNotification('Bitte w√§hle zuerst einen Text aus', 'error');
        return;
      }
      
      if (!selectedText.webhook) {
        showNotification('Kein Webhook f√ºr diesen Text konfiguriert', 'error');
        return;
      }
      
      const editedContent = editTextContent.value.trim();
      if (!editedContent) {
        showNotification('Text darf nicht leer sein', 'error');
        return;
      }
      
      try {
        // Lade-Animation starten
        const originalText = sendTextBtn.innerHTML;
        sendTextBtn.innerHTML = '<div class="loading mr-1"></div> Sende...';
        sendTextBtn.disabled = true;
        
        // Webhook-Call mit bearbeitetem Text
        await sendToDiscordWebhook(selectedText, editedContent);
        showNotification(`Text "${selectedText.title}" wurde an Discord gesendet`, 'success');
        
        // Aktualisiere lastUsed Zeitstempel
        selectedText.lastUsed = new Date().toISOString();
        saveTexts();
        renderTextList();
        
        // Zur√ºcksetzen
        textUseSection.classList.add('hidden');
        selectedText = null;
        originalContent = "";
        
        // Button zur√ºcksetzen
        sendTextBtn.innerHTML = originalText;
        sendTextBtn.disabled = false;
      } catch (error) {
        console.error('Fehler beim Senden an Discord:', error);
        showNotification('Fehler beim Senden an Discord: ' + error.message, 'error');
        
        // Button zur√ºcksetzen auch bei Fehler
        const originalText = '<i class="fas fa-paper-plane text-xs"></i> An Discord senden';
        sendTextBtn.innerHTML = originalText;
        sendTextBtn.disabled = false;
      }
    });

    // Text in Zwischenablage kopieren
    copyTextBtn.addEventListener('click', () => {
      const editedContent = editTextContent.value.trim();
      if (!editedContent) {
        showNotification('Text darf nicht leer sein', 'error');
        return;
      }
      
      navigator.clipboard.writeText(editedContent)
        .then(() => {
          showNotification('Text in die Zwischenablage kopiert', 'success');
          
          // Aktualisiere lastUsed Zeitstempel
          if (selectedText) {
            selectedText.lastUsed = new Date().toISOString();
            saveTexts();
            renderTextList();
          }
        })
        .catch(err => {
          console.error('Fehler beim Kopieren: ', err);
          showNotification('Fehler beim Kopieren des Texts', 'error');
        });
    });

    // Abbrechen
    cancelUseBtn.addEventListener('click', () => {
      // Text auf Original zur√ºcksetzen
      if (selectedText) {
        selectedText.content = originalContent;
      }
      
      textUseSection.classList.add('hidden');
      selectedText = null;
      originalContent = "";
      showNotification('Bearbeitung abgebrochen - Text wurde nicht gesendet', 'info');
    });

    // Zeichenz√§hler aktualisieren
    function updateCharCount(textarea, counter) {
      const length = textarea.value.length;
      counter.textContent = `${length} Zeichen`;
      
      // Warnung bei vielen Zeichen
      if (length > 1800) {
        counter.classList.add('error');
        counter.classList.remove('warning');
      } else if (length > 1500) {
        counter.classList.add('warning');
        counter.classList.remove('error');
      } else {
        counter.classList.remove('warning', 'error');
      }
    }

    // Zeichenz√§hler f√ºr Edit-Textarea
    editTextContent.addEventListener('input', () => {
      updateCharCount(editTextContent, editCharCount);
    });

    // Zeichenz√§hler f√ºr Neue-Text-Textarea
    newTextContent.addEventListener('input', () => {
      updateCharCount(newTextContent, newCharCount);
    });

    // Admin-Login
    adminLoginBtn.addEventListener('click', () => {
      if (adminPassInput.value === '1101') {
        adminError.classList.add('hidden');
        adminContent.classList.remove('hidden');
        renderTextManagementList();
        adminPassInput.value = '';
        showNotification('Admin-Bereich betreten', 'success');
      } else {
        adminError.classList.remove('hidden');
        adminPassInput.value = '';
        adminPassInput.focus();
        showNotification('Falsches Passwort', 'error');
      }
    });

    adminPassInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        adminLoginBtn.click();
      }
    });

    // Farbe √§ndern Event
    newTextColor.addEventListener('input', (e) => {
      newTextColorValue.textContent = e.target.value;
    });

    // Text hinzuf√ºgen
    addTextBtn.addEventListener('click', () => {
      const title = newTextTitle.value.trim();
      const content = newTextContent.value.trim();
      const webhook = newTextWebhook.value.trim();
      const color = newTextColor.value;
      
      if (!title || !content) {
        showNotification('Bitte Titel und Inhalt ausf√ºllen', 'error');
        return;
      }
      
      // Neue ID generieren
      const newId = texts.length > 0 ? Math.max(...texts.map(t => t.id)) + 1 : 1;
      
      // Neuen Text erstellen
      const newText = {
        id: newId,
        title,
        content,
        webhook,
        color,
        createdAt: new Date().toISOString(),
        lastUsed: null
      };
      
      texts.push(newText);
      saveTexts();
      
      // Formular zur√ºcksetzen
      newTextTitle.value = '';
      newTextContent.value = '';
      newTextWebhook.value = '';
      newTextColor.value = '#a855f7';
      newTextColorValue.textContent = '#a855f7';
      newCharCount.textContent = '0 Zeichen';
      
      // Listen aktualisieren
      renderTextList();
      renderTextManagementList();
      
      showNotification(`Text "${title}" hinzugef√ºgt`, 'success');
    });

    // Text-Verwaltungsliste rendern
    function renderTextManagementList() {
      textManagementList.innerHTML = '';
      
      if (texts.length === 0) {
        textManagementList.innerHTML = '<div class="text-center py-4 text-gray-400 text-sm"><p>Keine Texte vorhanden.</p></div>';
        return;
      }
      
      texts.forEach(text => {
        const textElement = document.createElement('div');
        textElement.className = 'p-3 rounded-lg bg-gray-800/50 border border-gray-700';
        
        // Webhook-Status
        let webhookStatus = 'webhook-empty';
        let webhookText = 'Kein Webhook';
        
        if (text.webhook) {
          if (text.webhook.startsWith('https://discord.com/api/webhooks/')) {
            webhookStatus = 'webhook-valid';
            webhookText = 'Webhook g√ºltig';
          } else {
            webhookStatus = 'webhook-invalid';
            webhookText = 'Webhook ung√ºltig';
          }
        }
        
        textElement.innerHTML = `
          <div class="flex justify-between items-start mb-2">
            <div class="flex items-center">
              <span class="color-preview" style="background-color: ${text.color}"></span>
              <h3 class="font-semibold text-sm text-white">${text.title}</h3>
            </div>
            <div class="flex gap-1">
              <button class="edit-text-btn px-2 py-1 bg-blue-600 hover:bg-blue-500 rounded text-xs" data-id="${text.id}">
                <i class="fas fa-edit text-xs"></i> Bearbeiten
              </button>
              <button class="delete-text-btn px-2 py-1 bg-red-600 hover:bg-red-500 rounded text-xs" data-id="${text.id}">
                <i class="fas fa-trash text-xs"></i> L√∂schen
              </button>
            </div>
          </div>
          <div class="text-xs text-gray-300 mb-2">${text.content}</div>
          <div class="text-xs text-gray-400">
            <div class="flex justify-between">
              <span class="font-medium">Erstellt:</span> ${new Date(text.createdAt).toLocaleDateString('de-DE')}
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Zuletzt verwendet:</span> ${text.lastUsed ? new Date(text.lastUsed).toLocaleDateString('de-DE') : 'Noch nie'}
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Webhook:</span> 
              <span class="${webhookStatus}">${webhookText}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Farbe:</span> ${text.color}
            </div>
          </div>
        `;
        
        textManagementList.appendChild(textElement);
      });
      
      // Event-Listener f√ºr Bearbeiten-Buttons
      document.querySelectorAll('.edit-text-btn').forEach(button => {
        button.addEventListener('click', (e) => {
          const id = parseInt(e.target.closest('button').getAttribute('data-id'));
          editTextAdmin(id);
        });
      });
      
      // Event-Listener f√ºr L√∂schen-Buttons
      document.querySelectorAll('.delete-text-btn').forEach(button => {
        button.addEventListener('click', (e) => {
          const id = parseInt(e.target.closest('button').getAttribute('data-id'));
          deleteText(id);
        });
      });
    }

    // Text bearbeiten (Admin)
    function editTextAdmin(id) {
      const text = texts.find(t => t.id === id);
      if (!text) return;
      
      const newTitle = prompt('Neuen Titel eingeben:', text.title);
      if (newTitle === null) return; // Benutzer hat abgebrochen
      
      const newContent = prompt('Neuen Inhalt eingeben:', text.content);
      if (newContent === null) return; // Benutzer hat abgebrochen
      
      const newWebhook = prompt('Neue Webhook URL eingeben:', text.webhook);
      if (newWebhook === null) return; // Benutzer hat abgebrochen
      
      const newColor = prompt('Neue Farbe eingeben (Hex-Code):', text.color);
      if (newColor === null) return; // Benutzer hat abgebrochen
      
      text.title = newTitle.trim();
      text.content = newContent.trim();
      text.webhook = newWebhook.trim();
      text.color = newColor.trim();
      
      // Texte speichern
      saveTexts();
      
      // Listen aktualisieren
      renderTextList();
      renderTextManagementList();
      
      showNotification(`Text "${text.title}" bearbeitet`, 'success');
    }

    // Text l√∂schen
    function deleteText(id) {
      const text = texts.find(t => t.id === id);
      if (!text) return;
      
      if (confirm(`Text "${text.title}" wirklich l√∂schen?`)) {
        texts = texts.filter(t => t.id !== id);
        
        // Texte speichern
        saveTexts();
        
        // Listen aktualisieren
        renderTextList();
        renderTextManagementList();
        
        showNotification(`Text "${text.title}" gel√∂scht`, 'success');
      }
    }

    // Suchfunktion
    searchTexts.addEventListener('input', () => {
      const searchTerm = searchTexts.value.toLowerCase().trim();
      
      if (searchTerm === '') {
        filteredTexts = [...texts];
      } else {
        filteredTexts = texts.filter(text => 
          text.title.toLowerCase().includes(searchTerm) || 
          text.content.toLowerCase().includes(searchTerm)
        );
      }
      
      renderTextList();
    });

    // Initialisierung
    checkExistingLogin();

    // Webhook-Funktion - NUR EMBED
    async function sendToDiscordWebhook(text, content) {
      if (!text.webhook) {
        throw new Error('Kein Webhook konfiguriert');
      }
      
      // Pr√ºfe ob die Webhook-URL g√ºltig ist
      if (!text.webhook.startsWith('https://discord.com/api/webhooks/')) {
        throw new Error('Ung√ºltige Webhook URL');
      }
      
      const response = await fetch(text.webhook, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          // KEIN content Feld - nur Embed
          username: 'Text Manager',
          embeds: [
            {
              title: text.title,
              description: content,
              color: parseInt(text.color.replace('#', ''), 16),
              timestamp: new Date().toISOString(),
              footer: {
                text: 'Gesendet via Text Manager'
              }
            }
          ]
        })
      });
      
      if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`Webhook Fehler: ${response.status} - ${errorText}`);
      }
      
      return response;
    }
  </script>
</body>
</html>
